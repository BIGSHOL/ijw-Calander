# Firebase ë¹„ìš© ìµœì í™” ì¢…í•© ë³´ê³ ì„œ

**í”„ë¡œì íŠ¸**: ijw-calander
**ë¶„ì„ ì¼ì‹œ**: 2025-12-31
**ë¶„ì„ ë„êµ¬**: firebase-cost-optimizer agent

---

## ğŸ“Š Executive Summary

### í˜„ì¬ ìƒíƒœ
- **ì¼ì¼ ì½ê¸° ì‘ì—…**: ~7,100íšŒ
- **ì¼ì¼ ì“°ê¸° ì‘ì—…**: ~90íšŒ
- **ì›”ê°„ ì˜ˆìƒ ë¹„ìš©**: $0.00 (ë¬´ë£Œ ë²”ìœ„)
- **ë¬´ë£Œ í• ë‹¹ëŸ‰ ì‚¬ìš©ë¥ **: ì½ê¸° 14.2%, ì“°ê¸° 0.45%
- **ì¢…í•© í‰ê°€**: ğŸŸ¢ ë§¤ìš° ì•ˆì „

### í•µì‹¬ ë°œê²¬ì‚¬í•­
1. **11ê°œì˜ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆê°€ í•­ìƒ í™œì„±í™”** - ê·¸ì¤‘ 7ê°œëŠ” ì •ì  ë°ì´í„°
2. **í´ë¼ì´ì–¸íŠ¸ ì¸¡ ìºì‹± ë¶€ì¬** - í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ë§ˆë‹¤ ì „ì²´ ì¬ë¡œë“œ
3. **ì‚¬ìš©ì ëª©ë¡ ì „ì²´ êµ¬ë…** - í•„ìš” ì—¬ë¶€ì™€ ë¬´ê´€í•˜ê²Œ 20ëª… ì „ì²´ ì¡°íšŒ
4. **í˜„ì¬ëŠ” ë¬´ë£Œ ë²”ìœ„ ë‚´ì´ì§€ë§Œ, ì‚¬ìš©ì ì¦ê°€ ì‹œ ë¹„ìš© í­ì¦ ìœ„í—˜**

### ê¶Œì¥ ì¡°ì¹˜
- **ì¦‰ì‹œ ì ìš©**: React Query ë„ì…ìœ¼ë¡œ ì •ì  ë°ì´í„° ìºì‹± (2-3ì‹œê°„)
- **ì˜ˆìƒ ì ˆê°**: ì½ê¸° 70% ê°ì†Œ
- **ë¯¸ë˜ ëŒ€ë¹„**: ì‚¬ìš©ì 100ëª… ì¦ê°€ ì‹œ ì›” $3.60 â†’ $0.00 ìœ ì§€

---

## ğŸ“ˆ í˜„ì¬ ìƒíƒœ ë¶„ì„

### ë°ì´í„° ê·œëª¨ ì¶”ì •
- ë¶€ì„œëª©ë¡: ~50ê°œ
- ì¼ì •: ~500ê°œ (2ë…„ì¹˜)
- ì‚¬ìš©ì: ~20ëª…
- ìˆ˜ì—…ëª©ë¡: ~30ê°œ
- ê°•ì‚¬ëª©ë¡: ~15ëª…
- ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ: 11ê°œ (í•­ìƒ í™œì„±)
- ì¼ì¼ í™œì„± ì‚¬ìš©ì: ~10ëª…

### ì˜ˆìƒ ì½ê¸° ì‘ì—…
```
ì´ˆê¸° ë¡œë“œ (ë¦¬ìŠ¤ë„ˆ êµ¬ë…)
- ë¶€ì„œ: 50íšŒ
- ì¼ì •: 500íšŒ
- ì‚¬ìš©ì: 20íšŒ
- ìˆ˜ì—…: 30íšŒ
- ê°•ì‚¬: 15íšŒ
- ê¸°íƒ€: 85íšŒ (íœ´ì¼, ì„¤ì • ë“±)
----------------------------
= 700íšŒ/ì‚¬ìš©ì

ì¼ì¼ í™œì„± ì‚¬ìš©ì: 10ëª…
ì¼ì¼ ì¬ì ‘ì†/ìƒˆë¡œê³ ì¹¨: 10ëª… Ã— 700íšŒ = 7,000íšŒ
ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸: ~100íšŒ
----------------------------
ì¼ì¼ ì´ ì½ê¸°: ~7,100íšŒ
ì›”ê°„ ì´ ì½ê¸°: 213,000íšŒ
```

### ì˜ˆìƒ ì“°ê¸° ì‘ì—…
```
ì¼ì • ìƒì„±/ìˆ˜ì •: ~50íšŒ
í•™ìƒ ê´€ë¦¬: ~30íšŒ
ì„¤ì • ë³€ê²½: ~10íšŒ
----------------------------
ì¼ì¼ ì´ ì“°ê¸°: ~90íšŒ
ì›”ê°„ ì´ ì“°ê¸°: 2,700íšŒ
```

### ì›”ê°„ ë¹„ìš© ì¶”ì‚°
```
Firestore ë¬´ë£Œ í• ë‹¹ëŸ‰ (Spark í”Œëœ)
- ì½ê¸°: 1,500,000íšŒ/ì›”
- ì“°ê¸°: 600,000íšŒ/ì›”
- ì‚­ì œ: 600,000íšŒ/ì›”

í˜„ì¬ ì‚¬ìš©ëŸ‰
- ì½ê¸°: 213,000íšŒ (14.2%)
- ì“°ê¸°: 2,700íšŒ (0.45%)
----------------------------
ì›”ê°„ ì˜ˆìƒ ë¹„ìš©: $0.00
```

---

## ğŸ”¥ ë¹„ìš© ë°œìƒ í•«ìŠ¤íŒŸ ë¶„ì„

### 1ìˆœìœ„: ê³¼ë„í•œ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ âš ï¸ Critical

**ìœ„ì¹˜**: [App.tsx:298-431](../App.tsx#L298-L431)

**ë¬¸ì œì **:
```typescript
// 11ê°œì˜ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆê°€ í•­ìƒ í™œì„±í™”
// ê·¸ì¤‘ 7ê°œëŠ” ì •ì  ë°ì´í„° (ë³€ê²½ ë¹ˆë„ ë‚®ìŒ)

// 1. ë¶€ì„œ ëª©ë¡ (ë¼ì¸ 298-305)
useEffect(() => {
  const unsubscribe = onSnapshot(
    query(collection(db, "ë¶€ì„œëª©ë¡"), orderBy("ìˆœì„œ")),
    (snapshot) => {
      const loadDepts = snapshot.docs.map(doc => doc.data() as Department);
      setDepartments(loadDepts);
    }
  );
  return () => unsubscribe();
}, []);

// 2. ì¼ì • ëª©ë¡ (ë¼ì¸ 336-350)
useEffect(() => {
  const unsubscribe = onSnapshot(
    query(collection(db, "ì¼ì •")),
    (snapshot) => {
      const loadEvents = snapshot.docs.map(doc => doc.data() as CalendarEvent);
      setEvents(loadEvents);
    }
  );
  return () => unsubscribe();
}, []);

// ... ì´ 11ê°œ ë¦¬ìŠ¤ë„ˆ
```

**ë¹„ìš© ì˜í–¥**:
- í˜„ì¬: ì‚¬ìš©ìë‹¹ 700íšŒ ì´ˆê¸° ë¡œë“œ
- 10ëª… Ã— 700íšŒ = 7,000íšŒ/ì¼
- **ì‚¬ìš©ì 100ëª… ì¦ê°€ ì‹œ: 70,000íšŒ/ì¼** â†’ ì›” 2,100,000íšŒ (ë¬´ë£Œ ì´ˆê³¼ $7.20)

**ê°œì„  ë°©ì•ˆ**:
```typescript
// âœ… ì •ì  ë°ì´í„°ëŠ” ì¼ë°˜ ì¿¼ë¦¬ + React Query ìºì‹±

// Before: ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ
useEffect(() => {
  const unsubscribe = onSnapshot(collection(db, "ë¶€ì„œëª©ë¡"), ...);
  return () => unsubscribe();
}, []);

// After: ìºì‹± ì¿¼ë¦¬
const { data: departments } = useQuery({
  queryKey: ['departments'],
  queryFn: async () => {
    const snapshot = await getDocs(
      query(collection(db, 'ë¶€ì„œëª©ë¡'), orderBy('ìˆœì„œ'))
    );
    return snapshot.docs.map(doc => doc.data() as Department);
  },
  staleTime: 1000 * 60 * 30, // 30ë¶„ê°„ ì¬ìš”ì²­ ì•ˆ í•¨
  cacheTime: 1000 * 60 * 60, // 1ì‹œê°„ ìºì‹œ ìœ ì§€
});
```

**ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆê°€ í•„ìš”í•œ ë°ì´í„°**: ì¼ì •, ì‚¬ìš©ì í”„ë¡œí•„
**ë¶ˆí•„ìš”í•œ ë°ì´í„°**: ë¶€ì„œ, ê°•ì‚¬, íœ´ì¼, ì„¤ì •, ìˆ˜ì—… í‚¤ì›Œë“œ

**ì˜ˆìƒ ì ˆê°**: ì´ˆê¸° ë¡œë“œ í›„ ë¶ˆí•„ìš”í•œ ì¬êµ¬ë… ì œê±° â†’ **ì½ê¸° 70% ê°ì†Œ**

---

### 2ìˆœìœ„: ì‚¬ìš©ì ëª©ë¡ ì „ì²´ êµ¬ë… âš ï¸ High

**ìœ„ì¹˜**: [App.tsx:210-218](../App.tsx#L210-L218)

**ë¬¸ì œì **:
```typescript
// ëª¨ë“  ì‚¬ìš©ìê°€ ì „ì²´ ì‚¬ìš©ì ëª©ë¡ì„ ì‹¤ì‹œê°„ êµ¬ë…
// ì‹¤ì œë¡œëŠ” ì´ë²¤íŠ¸ ì°¸ê°€ì ì„ íƒ ì‹œì—ë§Œ í•„ìš”

useEffect(() => {
  const unsubscribe = onSnapshot(collection(db, 'users'), (snapshot) => {
    const loadUsers = snapshot.docs.map(doc => doc.data() as UserProfile);
    setUsers(loadUsers); // 20ëª… Ã— 10ëª… ì ‘ì† = 200 ì½ê¸°
  });
  return () => unsubscribe();
}, []);
```

**ë¹„ìš© ì˜í–¥**:
- í˜„ì¬: 20ëª… Ã— 10ëª… ì ‘ì† = 200íšŒ/ì¼
- **ì‚¬ìš©ì 100ëª… ì¦ê°€ ì‹œ**: 100ëª… Ã— 10ëª… ì ‘ì† = **1,000íšŒ/ì¼**
- ì›”ê°„: 30,000íšŒ (ì•„ì§ ë¬´ë£Œì§€ë§Œ ë¶ˆí•„ìš”í•œ ë‚­ë¹„)

**ê°œì„  ë°©ì•ˆ**:
```typescript
// âœ… ì´ë²¤íŠ¸ ëª¨ë‹¬ ì—´ë¦´ ë•Œë§Œ ë¡œë“œ

const { data: users } = useQuery({
  queryKey: ['users'],
  queryFn: async () => {
    const snapshot = await getDocs(collection(db, 'users'));
    return snapshot.docs.map(doc => doc.data() as UserProfile);
  },
  enabled: isEventModalOpen, // ëª¨ë‹¬ ì—´ë¦´ ë•Œë§Œ ì¿¼ë¦¬ ì‹¤í–‰
  staleTime: 1000 * 60 * 10, // 10ë¶„ ìºì‹±
});

// ë˜ëŠ” í•„ìš”í•œ í•„ë“œë§Œ ì¡°íšŒí•˜ëŠ” ê²½ëŸ‰ ë·° ìƒì„±
const usersLight = await getDocs(
  query(collection(db, 'users'))
).then(snapshot =>
  snapshot.docs.map(doc => ({
    uid: doc.data().uid,
    displayName: doc.data().displayName,
    email: doc.data().email
  }))
);
```

**ì˜ˆìƒ ì ˆê°**: 200íšŒ/ì¼ â†’ 20íšŒ/ì¼ (**-90%**)

---

### 3ìˆœìœ„: ì˜ì–´ ì‹œê°„í‘œ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ âš ï¸ Medium

**ìœ„ì¹˜**: [EnglishTimetable.tsx:39-71](../components/Timetable/English/EnglishTimetable.tsx#L39-L71)

**ë¬¸ì œì **:
```typescript
// ì˜ì–´ ì‹œê°„í‘œ ì „ì²´ ì‹¤ì‹œê°„ êµ¬ë…
// í¸ì§‘ ëª¨ë“œê°€ ì•„ë‹ ë•Œë„ í•­ìƒ êµ¬ë…

useEffect(() => {
  const unsubscribe = onSnapshot(
    collection(db, EN_COLLECTION),
    (snapshot) => {
      const mergedData: ScheduleData = {};
      snapshot.docs.forEach((docSnap) => {
        const data = docSnap.data();
        Object.entries(data).forEach(([day, timeSlots]) => {
          // ë§ì€ ì²˜ë¦¬...
        });
      });
      setScheduleData(mergedData);
    }
  );
  return () => unsubscribe();
}, []);
```

**ë¹„ìš© ì˜í–¥**:
- ë°ì´í„° í¬ê¸°: ~700ê°œ ì…€ (7ì¼ Ã— 10êµì‹œ Ã— 10ëª…)
- ì¼ì¼ 5ëª… ì ‘ì† ì‹œ: 5 Ã— 700 = **3,500íšŒ**

**ê°œì„  ë°©ì•ˆ**:
```typescript
// âœ… ìºì‹± + í¸ì§‘ ëª¨ë“œì—ì„œë§Œ ì‹¤ì‹œê°„ êµ¬ë…

// 1. ê¸°ë³¸ì€ ìºì‹± ì¿¼ë¦¬
const { data: scheduleData } = useQuery({
  queryKey: ['english-schedule'],
  queryFn: async () => {
    const snapshot = await getDocs(collection(db, EN_COLLECTION));
    const mergedData: ScheduleData = {};
    snapshot.docs.forEach((docSnap) => {
      // ì²˜ë¦¬...
    });
    return mergedData;
  },
  staleTime: 1000 * 60 * 5, // 5ë¶„ ìºì‹±
});

// 2. í¸ì§‘ ëª¨ë“œì¼ ë•Œë§Œ ì‹¤ì‹œê°„ êµ¬ë…
useEffect(() => {
  if (!isEditMode) return; // í¸ì§‘ ëª¨ë“œ ì•„ë‹ˆë©´ êµ¬ë… ì•ˆ í•¨

  const unsubscribe = onSnapshot(
    collection(db, EN_COLLECTION),
    (snapshot) => {
      // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸...
    }
  );

  return () => unsubscribe();
}, [isEditMode]);
```

**ì˜ˆìƒ ì ˆê°**: 3,500íšŒ/ì¼ â†’ 700íšŒ/ì¼ (**-80%**)

---

### 4ìˆœìœ„: í•™ìƒ ëª©ë¡ ì¡°íšŒ íŒ¨í„´ âš ï¸ Medium

**ìœ„ì¹˜**: [StudentModal.tsx:58-117](../components/Timetable/English/StudentModal.tsx#L58-L117)

**ë¬¸ì œì **:
```typescript
// 1. ì´ˆê¸° ë¡œë“œëŠ” getDocs ì‚¬ìš© (ì¢‹ìŒ)
const snapshot = await getDocs(q);

// 2. í•˜ì§€ë§Œ ì´í›„ ì‹¤ì‹œê°„ êµ¬ë… ì¶”ê°€ (ë¶ˆí•„ìš”)
useEffect(() => {
  if (!classDocId) return;

  const unsub = onSnapshot(
    doc(db, 'ìˆ˜ì—…ëª©ë¡', classDocId),
    (docSnap) => {
      // í•™ìƒ ì¶”ê°€/ì‚­ì œëŠ” ëª¨ë‹¬ ë‚´ë¶€ì—ì„œë§Œ ë°œìƒ
      // ì™¸ë¶€ ë³€ê²½ ê°ì§€ í•„ìš”ì„± ë‚®ìŒ
    }
  );

  return () => unsub();
}, [classDocId]);
```

**ë¹„ìš© ì˜í–¥**:
- ëª¨ë‹¬ ì—´ ë•Œë§ˆë‹¤ ì‹¤ì‹œê°„ êµ¬ë…
- í•˜ë£¨ 30ë²ˆ ëª¨ë‹¬ ì˜¤í”ˆ ì‹œ: 30 Ã— í‰ê·  15ëª… = **450íšŒ**

**ê°œì„  ë°©ì•ˆ**:
```typescript
// âœ… ëª¨ë‹¬ ë‚´ì—ì„œë§Œ ì‘ì—…í•˜ë¯€ë¡œ ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë¡œ ì¶©ë¶„

const { data: students, mutate } = useQuery({
  queryKey: ['class-students', classDocId],
  queryFn: async () => {
    const docSnap = await getDoc(doc(db, 'ìˆ˜ì—…ëª©ë¡', classDocId));
    return docSnap.data()?.studentList || [];
  },
  staleTime: Infinity, // ëª¨ë‹¬ ë‹«ê¸° ì „ê¹Œì§€ ìœ ì§€
  enabled: !!classDocId,
});

// í•™ìƒ ì¶”ê°€ëŠ” mutationìœ¼ë¡œ ì²˜ë¦¬
const addStudentMutation = useMutation({
  mutationFn: async (newStudent: TimetableStudent) => {
    await updateDoc(doc(db, 'ìˆ˜ì—…ëª©ë¡', classDocId), {
      studentList: [...students, newStudent]
    });
  },
  onSuccess: () => {
    mutate(); // ë¡œì»¬ ìºì‹œ ê°±ì‹ 
  }
});

// í•™ìƒ ì‚­ì œë„ ë™ì¼
const removeStudentMutation = useMutation({
  mutationFn: async (studentId: string) => {
    await updateDoc(doc(db, 'ìˆ˜ì—…ëª©ë¡', classDocId), {
      studentList: students.filter(s => s.id !== studentId)
    });
  },
  onSuccess: () => {
    mutate();
  }
});
```

**ì˜ˆìƒ ì ˆê°**: 450íšŒ/ì¼ â†’ 30íšŒ/ì¼ (**-93%**)

---

## ğŸ—ï¸ ë°ì´í„° êµ¬ì¡° ê°œì„  ì œì•ˆ

### 1. ì´ë²¤íŠ¸ ì°¸ê°€ì ë¹„ì •ê·œí™” (ì„ íƒ)

**í˜„ì¬ êµ¬ì¡°**:
```typescript
interface CalendarEvent {
  participantIds: string[]; // UIDë§Œ ì €ì¥
  attendance: Record<string, 'pending' | 'joined' | 'declined'>;
}

// í‘œì‹œí•  ë•Œ users ì»¬ë ‰ì…˜ ì¡°íšŒ í•„ìš”
const participantNames = participantIds.map(uid =>
  users.find(u => u.uid === uid)?.displayName
);
```

**ê°œì„ ì•ˆ**:
```typescript
interface CalendarEvent {
  participantIds: string[];
  participantNames: Record<string, string>; // { uid: displayName }
  attendance: Record<string, 'pending' | 'joined' | 'declined'>;
}

// ì´ë²¤íŠ¸ ìƒì„±/ìˆ˜ì • ì‹œ ì´ë¦„ í¬í•¨
await setDoc(doc(db, 'ì¼ì •', eventId), {
  ...event,
  participantNames: Object.fromEntries(
    event.participantIds.map(uid => [
      uid,
      users.find(u => u.uid === uid)?.displayName
    ])
  )
});
```

**íš¨ê³¼**:
- ì´ë²¤íŠ¸ í‘œì‹œ ì‹œ users ì»¬ë ‰ì…˜ ì¡°íšŒ ë¶ˆí•„ìš”
- ì½ê¸° ê°ì†Œ: ë§¤ ì´ë²¤íŠ¸ ë¡œë“œë§ˆë‹¤ 20ëª… ì¡°íšŒ â†’ 0íšŒ

**Trade-off**:
- ì‚¬ìš©ì ì´ë¦„ ë³€ê²½ ì‹œ ëª¨ë“  ê´€ë ¨ ì´ë²¤íŠ¸ ì—…ë°ì´íŠ¸ í•„ìš”
- ì“°ê¸° ì¦ê°€ (ë“œë¬¼ê²Œ ë°œìƒí•˜ë¯€ë¡œ ë¹„ìš© ì˜í–¥ ë¯¸ë¯¸)

**ê¶Œì¥ ì—¬ë¶€**: ğŸŸ¡ ì„ íƒ (í˜„ì¬ëŠ” í•„ìš” ì—†ì§€ë§Œ, ì´ë²¤íŠ¸ ë§ì•„ì§€ë©´ ê³ ë ¤)

---

### 2. ìˆ˜ì—…-í•™ìƒ ê´€ê³„ ê²½ëŸ‰í™” (ê¶Œì¥)

**í˜„ì¬ êµ¬ì¡°**:
```typescript
// ìˆ˜ì—…ëª©ë¡ ë¬¸ì„œì— ì „ì²´ í•™ìƒ ì •ë³´ í¬í•¨
interface TimetableClass {
  studentList: TimetableStudent[]; // ì „ì²´ ì •ë³´
}

interface TimetableStudent {
  id: string;
  name: string;
  englishName?: string;
  grade?: string;
  school?: string;
  underline?: boolean;
}
```

**ë¬¸ì œì **:
- ì‹œê°„í‘œ ë¡œë“œ ì‹œ í•™ìƒ ìƒì„¸ ì •ë³´ ë¶ˆí•„ìš”
- 30ê°œ ìˆ˜ì—… Ã— í‰ê·  15ëª… = **450íšŒ ì½ê¸°**
- í•™ìƒ ìˆ˜ê°€ ë§ì•„ì§€ë©´ ë¬¸ì„œ í¬ê¸° ì¦ê°€ (1MB ì œí•œ)

**ê°œì„ ì•ˆ**:
```typescript
// ìˆ˜ì—… ë¬¸ì„œëŠ” ê²½ëŸ‰í™”
interface TimetableClass {
  studentIds: string[]; // IDë§Œ
  studentCount: number; // ì‚¬ì „ ê³„ì‚°
  // ... ê¸°íƒ€ ì •ë³´
}

// ì„œë¸Œì»¬ë ‰ì…˜: ìˆ˜ì—…ëª©ë¡/{classId}/students/{studentId}
// í•™ìƒ ìƒì„¸ ì •ë³´ëŠ” í•„ìš”í•  ë•Œë§Œ ë¡œë“œ
```

**íš¨ê³¼**:
- ì‹œê°„í‘œ ë¡œë“œ: 30ê°œ ìˆ˜ì—…ë§Œ = **30íšŒ ì½ê¸°** (-93%)
- í•™ìƒ ìƒì„¸ ë³´ê¸° (ëª¨ë‹¬): í•„ìš”í•œ ìˆ˜ì—…ë§Œ 15íšŒ

**êµ¬í˜„ ë°©ë²•**:
```typescript
// ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸
async function migrateStudentsToSubcollection() {
  const batch = writeBatch(db);
  const classes = await getDocs(collection(db, 'ìˆ˜ì—…ëª©ë¡'));

  for (const classDoc of classes.docs) {
    const data = classDoc.data();
    const students = data.studentList || [];

    // ì„œë¸Œì»¬ë ‰ì…˜ìœ¼ë¡œ ì´ë™
    students.forEach((student: TimetableStudent) => {
      const ref = doc(
        db,
        'ìˆ˜ì—…ëª©ë¡',
        classDoc.id,
        'students',
        student.id
      );
      batch.set(ref, student);
    });

    // ì›ë³¸ í•„ë“œ ì œê±°, ë©”íƒ€ë°ì´í„°ë§Œ ìœ ì§€
    batch.update(classDoc.ref, {
      studentList: deleteField(),
      studentCount: students.length,
      studentIds: students.map((s: TimetableStudent) => s.id)
    });
  }

  await batch.commit();
}

// ì‹œê°„í‘œ ë¡œë“œ (ê²½ëŸ‰)
const classes = await getDocs(collection(db, 'ìˆ˜ì—…ëª©ë¡'));
// 30íšŒ ì½ê¸°

// í•™ìƒ ëª¨ë‹¬ ì˜¤í”ˆ (í•„ìš”í•  ë•Œë§Œ)
const students = await getDocs(
  collection(db, 'ìˆ˜ì—…ëª©ë¡', classId, 'students')
);
// 15íšŒ ì½ê¸°
```

**ê¶Œì¥ ì—¬ë¶€**: ğŸŸ¢ ê¶Œì¥ (íŠ¹íˆ í•™ìƒ ìˆ˜ ì¦ê°€ ì‹œ)

---

## âš›ï¸ React Query ë„ì… ê°€ì´ë“œ

### í˜„ì¬ ë¬¸ì œì 
- í´ë¼ì´ì–¸íŠ¸ ì¸¡ ìºì‹± ë¶€ì¬
- í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œë§ˆë‹¤ ì „ì²´ ì¬ë¡œë“œ
- ì»´í¬ë„ŒíŠ¸ ë¦¬ë Œë”ë§ ì‹œ ì¤‘ë³µ ì¿¼ë¦¬
- ë‚™ê´€ì  ì—…ë°ì´íŠ¸ ë¯¸ì§€ì›

### React Query ë„ì… íš¨ê³¼

#### 1. ìë™ ìºì‹±
```typescript
// Before: í˜ì´ì§€ ì´ë™í•  ë•Œë§ˆë‹¤ ì¬ë¡œë“œ
useEffect(() => {
  const unsubscribe = onSnapshot(
    collection(db, 'ë¶€ì„œëª©ë¡'),
    (snapshot) => {
      setDepartments(snapshot.docs.map(doc => doc.data()));
    }
  );
  return () => unsubscribe();
}, []);

// After: 30ë¶„ê°„ ìºì‹œ ìœ ì§€
const { data: departments } = useQuery({
  queryKey: ['departments'],
  queryFn: async () => {
    const snapshot = await getDocs(
      query(collection(db, 'ë¶€ì„œëª©ë¡'), orderBy('ìˆœì„œ'))
    );
    return snapshot.docs.map(doc => doc.data() as Department);
  },
  staleTime: 1000 * 60 * 30, // 30ë¶„ê°„ ì¬ìš”ì²­ ì•ˆ í•¨
  cacheTime: 1000 * 60 * 60, // 1ì‹œê°„ ìºì‹œ ìœ ì§€
});
```

**ì ˆê° íš¨ê³¼**:
- í˜ì´ì§€ ì´ë™ 10íšŒ â†’ 1íšŒ ì¿¼ë¦¬ë§Œ ì‹¤í–‰
- ë¶€ì„œ 50ê°œ Ã— 10íšŒ = 500íšŒ â†’ 50íšŒ (**-90%**)

#### 2. ì¡°ê±´ë¶€ ì¿¼ë¦¬
```typescript
// ëª¨ë‹¬ ì—´ë¦´ ë•Œë§Œ ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ
const { data: users } = useQuery({
  queryKey: ['users'],
  queryFn: async () => {
    const snapshot = await getDocs(collection(db, 'users'));
    return snapshot.docs.map(doc => doc.data() as UserProfile);
  },
  enabled: isEventModalOpen, // falseë©´ ì¿¼ë¦¬ ì‹¤í–‰ ì•ˆ í•¨
  staleTime: 1000 * 60 * 10,
});
```

#### 3. ë‚™ê´€ì  ì—…ë°ì´íŠ¸
```typescript
const mutation = useMutation({
  mutationFn: async (newEvent: CalendarEvent) => {
    await setDoc(doc(db, 'ì¼ì •', newEvent.id), newEvent);
  },
  onMutate: async (newEvent) => {
    // 1. ì§„í–‰ ì¤‘ì¸ ì¿¼ë¦¬ ì·¨ì†Œ
    await queryClient.cancelQueries(['events']);

    // 2. ì´ì „ ë°ì´í„° ë°±ì—…
    const previousEvents = queryClient.getQueryData(['events']);

    // 3. UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (ì½ê¸° ì—†ìŒ!)
    queryClient.setQueryData(['events'], (old: CalendarEvent[]) =>
      [...old, newEvent]
    );

    return { previousEvents };
  },
  onError: (err, newEvent, context) => {
    // ì‹¤íŒ¨ ì‹œ ë¡¤ë°±
    queryClient.setQueryData(['events'], context.previousEvents);
  },
  onSettled: () => {
    // ìµœì¢… ë™ê¸°í™”
    queryClient.invalidateQueries(['events']);
  }
});
```

**ì ˆê° íš¨ê³¼**:
- ì¼ì • ì¶”ê°€ í›„ ì¬ì¡°íšŒ ë¶ˆí•„ìš”
- 500íšŒ ì½ê¸° â†’ 0íšŒ (ì“°ê¸°ë§Œ 1íšŒ)

#### 4. ë³‘ë ¬ ì¿¼ë¦¬
```typescript
// ì—¬ëŸ¬ ì»¬ë ‰ì…˜ì„ ë³‘ë ¬ë¡œ ë¡œë“œ
const { data: departments } = useQuery(['departments'], fetchDepartments);
const { data: instructors } = useQuery(['instructors'], fetchInstructors);
const { data: holidays } = useQuery(['holidays'], fetchHolidays);

// ëª¨ë‘ ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°
const results = useQueries([
  { queryKey: ['departments'], queryFn: fetchDepartments },
  { queryKey: ['instructors'], queryFn: fetchInstructors },
  { queryKey: ['holidays'], queryFn: fetchHolidays }
]);

const isLoading = results.some(result => result.isLoading);
```

### ì„¤ì¹˜ ë° ì„¤ì •

#### 1. íŒ¨í‚¤ì§€ ì„¤ì¹˜
```bash
npm install @tanstack/react-query
```

#### 2. QueryClient ì„¤ì •
```typescript
// src/queryClient.ts
import { QueryClient } from '@tanstack/react-query';

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 1000 * 60 * 5, // 5ë¶„ ê¸°ë³¸ ìºì‹±
      cacheTime: 1000 * 60 * 30, // 30ë¶„ ìºì‹œ ë³´ê´€
      refetchOnWindowFocus: false, // ìœˆë„ìš° í¬ì»¤ìŠ¤ ì‹œ ì¬ì¡°íšŒ ì•ˆ í•¨
      retry: 1, // ì‹¤íŒ¨ ì‹œ 1íšŒ ì¬ì‹œë„
    },
  },
});
```

#### 3. Provider ì„¤ì •
```typescript
// App.tsx
import { QueryClientProvider } from '@tanstack/react-query';
import { queryClient } from './queryClient';

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      {/* ê¸°ì¡´ ì•± ì½”ë“œ */}
    </QueryClientProvider>
  );
}
```

#### 4. ê°œë°œ ë„êµ¬ (ì„ íƒ)
```bash
npm install @tanstack/react-query-devtools
```

```typescript
import { ReactQueryDevtools } from '@tanstack/react-query-devtools';

<QueryClientProvider client={queryClient}>
  <App />
  <ReactQueryDevtools initialIsOpen={false} />
</QueryClientProvider>
```

---

## ğŸ“‹ ìµœì í™” ë¡œë“œë§µ

### Phase 1: Quick Wins (2-3ì‹œê°„) âš¡

**ëª©í‘œ**: ì •ì  ë°ì´í„° ìºì‹±ìœ¼ë¡œ 70% ì½ê¸° ê°ì†Œ

#### ì‘ì—… ë‚´ìš©

##### 1.1 React Query ì„¤ì¹˜ (15ë¶„)
```bash
npm install @tanstack/react-query
```

##### 1.2 QueryClient ì„¤ì • (15ë¶„)
- `src/queryClient.ts` ìƒì„±
- [App.tsx](../App.tsx) ì— `QueryClientProvider` ì¶”ê°€

##### 1.3 ì •ì  ë°ì´í„° ìºì‹± ì „í™˜ (1.5ì‹œê°„)
**ëŒ€ìƒ**: ë¶€ì„œëª©ë¡, ê°•ì‚¬ëª©ë¡, íœ´ì¼, classKeywords

**ë³€ê²½ íŒŒì¼**: [App.tsx](../App.tsx)

**Before (ë¼ì¸ 298-305)**:
```typescript
useEffect(() => {
  const unsubscribe = onSnapshot(
    query(collection(db, "ë¶€ì„œëª©ë¡"), orderBy("ìˆœì„œ")),
    (snapshot) => {
      const loadDepts = snapshot.docs.map(doc => doc.data() as Department);
      setDepartments(loadDepts);
    }
  );
  return () => unsubscribe();
}, []);
```

**After**:
```typescript
const { data: departments } = useQuery({
  queryKey: ['departments'],
  queryFn: async () => {
    const snapshot = await getDocs(
      query(collection(db, 'ë¶€ì„œëª©ë¡'), orderBy('ìˆœì„œ'))
    );
    return snapshot.docs.map(doc => doc.data() as Department);
  },
  staleTime: 1000 * 60 * 30, // 30ë¶„
});
```

**ì ìš© ëŒ€ìƒ**:
- [ ] ë¶€ì„œëª©ë¡ (ë¼ì¸ 298-305)
- [ ] ê°•ì‚¬ëª©ë¡ (ë¼ì¸ 307-315)
- [ ] íœ´ì¼ ëª©ë¡ (ë¼ì¸ 317-325)
- [ ] classKeywords (ë¼ì¸ 327-334)

##### 1.4 ì‚¬ìš©ì ëª©ë¡ ì¡°ê±´ë¶€ ë¡œë“œ (30ë¶„)
**ë³€ê²½ íŒŒì¼**: [App.tsx:210-218](../App.tsx#L210-L218)

```typescript
// ì´ë²¤íŠ¸ ëª¨ë‹¬ ì—´ë¦´ ë•Œë§Œ ë¡œë“œ
const { data: users } = useQuery({
  queryKey: ['users'],
  queryFn: async () => {
    const snapshot = await getDocs(collection(db, 'users'));
    return snapshot.docs.map(doc => doc.data() as UserProfile);
  },
  enabled: isEventModalOpen,
  staleTime: 1000 * 60 * 10,
});
```

##### 1.5 ì˜ì–´ ì‹œê°„í‘œ ìºì‹± (30ë¶„)
**ë³€ê²½ íŒŒì¼**: [EnglishTimetable.tsx:39-71](../components/Timetable/English/EnglishTimetable.tsx#L39-L71)

```typescript
const { data: scheduleData } = useQuery({
  queryKey: ['english-schedule'],
  queryFn: async () => {
    const snapshot = await getDocs(collection(db, EN_COLLECTION));
    // ... ê¸°ì¡´ ì²˜ë¦¬ ë¡œì§
    return mergedData;
  },
  staleTime: 1000 * 60 * 5, // 5ë¶„
});
```

#### Phase 1 ì˜ˆìƒ ê²°ê³¼
| í•­ëª© | Before | After | ì ˆê° |
|------|--------|-------|------|
| ì¼ì¼ ì½ê¸° | 7,100 | 2,100 | -70% |
| ì›”ê°„ ì½ê¸° | 213,000 | 63,000 | -70% |
| ì‚¬ìš©ì 100ëª… ì‹œ | $3.60 | $1.08 | -70% |

---

### Phase 2: ë°ì´í„° êµ¬ì¡° ê°œì„  (1-2ì¼) ğŸ—ï¸

**ëª©í‘œ**: ìˆ˜ì—…-í•™ìƒ ê´€ê³„ ìµœì í™”ë¡œ ì¶”ê°€ 20% ì ˆê°

#### ì‘ì—… ë‚´ìš©

##### 2.1 ìˆ˜ì—…-í•™ìƒ ì„œë¸Œì»¬ë ‰ì…˜ ë§ˆì´ê·¸ë ˆì´ì…˜
**ì˜ˆìƒ ì‹œê°„**: 4ì‹œê°„

1. **ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±** (1ì‹œê°„)
```typescript
// scripts/migrateStudents.ts
import { db } from '../firebase';
import { collection, getDocs, writeBatch, doc, deleteField } from 'firebase/firestore';

async function migrateStudentsToSubcollection() {
  console.log('Starting migration...');

  const classesRef = collection(db, 'ìˆ˜ì—…ëª©ë¡');
  const classesSnapshot = await getDocs(classesRef);

  let batchCount = 0;
  let batch = writeBatch(db);

  for (const classDoc of classesSnapshot.docs) {
    const data = classDoc.data();
    const students = data.studentList || [];

    console.log(`Migrating ${students.length} students from ${classDoc.id}`);

    // ì„œë¸Œì»¬ë ‰ì…˜ìœ¼ë¡œ í•™ìƒ ë°ì´í„° ì´ë™
    for (const student of students) {
      const studentRef = doc(
        db,
        'ìˆ˜ì—…ëª©ë¡',
        classDoc.id,
        'students',
        student.id
      );
      batch.set(studentRef, student);
      batchCount++;

      // Firestore ë°°ì¹˜ëŠ” 500ê°œ ì œí•œ
      if (batchCount >= 450) {
        await batch.commit();
        batch = writeBatch(db);
        batchCount = 0;
        console.log('Batch committed');
      }
    }

    // ì›ë³¸ ë¬¸ì„œ ì—…ë°ì´íŠ¸
    batch.update(classDoc.ref, {
      studentList: deleteField(),
      studentCount: students.length,
      studentIds: students.map(s => s.id)
    });
    batchCount++;
  }

  // ë§ˆì§€ë§‰ ë°°ì¹˜ ì»¤ë°‹
  if (batchCount > 0) {
    await batch.commit();
  }

  console.log('Migration complete!');
}

migrateStudentsToSubcollection().catch(console.error);
```

2. **ë°±ì—… ìƒì„±** (30ë¶„)
```bash
# Firebase Consoleì—ì„œ ìˆ˜ë™ ë°±ì—… ë˜ëŠ”
firebase firestore:export gs://your-bucket/backups/$(date +%Y%m%d)
```

3. **ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰** (30ë¶„)
```bash
npx ts-node scripts/migrateStudents.ts
```

4. **ê²€ì¦** (1ì‹œê°„)
- ë°ì´í„° ë¬´ê²°ì„± í™•ì¸
- í•™ìƒ ìˆ˜ ì¼ì¹˜ ì—¬ë¶€ í™•ì¸
- ì‹œê°„í‘œ ì •ìƒ í‘œì‹œ í™•ì¸

##### 2.2 ì½”ë“œ ì—…ë°ì´íŠ¸
**ì˜ˆìƒ ì‹œê°„**: 3ì‹œê°„

**ë³€ê²½ íŒŒì¼**:
- [EnglishTimetable.tsx](../components/Timetable/English/EnglishTimetable.tsx)
- [StudentModal.tsx](../components/Timetable/English/StudentModal.tsx)

**Before**:
```typescript
// ì‹œê°„í‘œ ë¡œë“œ ì‹œ í•™ìƒ ì •ë³´ë„ í•¨ê»˜ ë¡œë“œ
const classDoc = await getDoc(doc(db, 'ìˆ˜ì—…ëª©ë¡', classId));
const students = classDoc.data()?.studentList || []; // 15ëª… Ã— 30ê°œ = 450íšŒ
```

**After**:
```typescript
// ì‹œê°„í‘œ ë¡œë“œ - ë©”íƒ€ë°ì´í„°ë§Œ
const classDoc = await getDoc(doc(db, 'ìˆ˜ì—…ëª©ë¡', classId));
const studentCount = classDoc.data()?.studentCount || 0; // 30íšŒ

// í•™ìƒ ìƒì„¸ - ëª¨ë‹¬ì—ì„œë§Œ
const studentsSnapshot = await getDocs(
  collection(db, 'ìˆ˜ì—…ëª©ë¡', classId, 'students')
); // í•„ìš”í•  ë•Œë§Œ 15íšŒ
```

##### 2.3 í•™ìƒ ëª¨ë‹¬ ë‚™ê´€ì  ì—…ë°ì´íŠ¸
**ì˜ˆìƒ ì‹œê°„**: 2ì‹œê°„

**ë³€ê²½ íŒŒì¼**: [StudentModal.tsx](../components/Timetable/English/StudentModal.tsx)

```typescript
// í•™ìƒ ì¶”ê°€ mutation
const addStudentMutation = useMutation({
  mutationFn: async (newStudent: TimetableStudent) => {
    await setDoc(
      doc(db, 'ìˆ˜ì—…ëª©ë¡', classDocId, 'students', newStudent.id),
      newStudent
    );
    await updateDoc(doc(db, 'ìˆ˜ì—…ëª©ë¡', classDocId), {
      studentCount: increment(1),
      studentIds: arrayUnion(newStudent.id)
    });
  },
  onMutate: async (newStudent) => {
    // UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸
    await queryClient.cancelQueries(['class-students', classDocId]);
    const previousStudents = queryClient.getQueryData(['class-students', classDocId]);

    queryClient.setQueryData(['class-students', classDocId], (old: TimetableStudent[]) =>
      [...old, newStudent]
    );

    return { previousStudents };
  },
  onError: (err, newStudent, context) => {
    queryClient.setQueryData(['class-students', classDocId], context.previousStudents);
  }
});

// í•™ìƒ ì‚­ì œ mutation
const removeStudentMutation = useMutation({
  mutationFn: async (studentId: string) => {
    await deleteDoc(
      doc(db, 'ìˆ˜ì—…ëª©ë¡', classDocId, 'students', studentId)
    );
    await updateDoc(doc(db, 'ìˆ˜ì—…ëª©ë¡', classDocId), {
      studentCount: increment(-1),
      studentIds: arrayRemove(studentId)
    });
  },
  onMutate: async (studentId) => {
    // UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸
    // ... ë™ì¼ íŒ¨í„´
  }
});
```

#### Phase 2 ì˜ˆìƒ ê²°ê³¼
| í•­ëª© | Before | After | ì ˆê° |
|------|--------|-------|------|
| ì‹œê°„í‘œ ë¡œë“œ | 450íšŒ | 30íšŒ | -93% |
| í•™ìƒ ëª¨ë‹¬ | 30íšŒ (ì‹¤ì‹œê°„) | 30íšŒ (í•„ìš”ì‹œ) | 0% |
| í•™ìƒ ì¶”ê°€ í›„ | 15íšŒ ì¬ì¡°íšŒ | 0íšŒ (ë‚™ê´€ì ) | -100% |

---

### Phase 3: ì¥ê¸° ê°œì„  (1ì£¼) ğŸ“Š

**ëª©í‘œ**: ë¹„ìš© ëª¨ë‹ˆí„°ë§ ë° ë¯¸ë˜ í™•ì¥ì„± í™•ë³´

#### 3.1 ë¹„ìš© ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ
**ì˜ˆìƒ ì‹œê°„**: 1ì¼

1. **Cloud Function ì‘ì„±**
```typescript
// functions/src/index.ts
import * as functions from 'firebase-functions';
import * as admin from 'firebase-admin';

admin.initializeApp();

export const trackFirestoreUsage = functions.pubsub
  .schedule('every 24 hours')
  .timeZone('Asia/Seoul')
  .onRun(async (context) => {
    // Firebase Console APIë¡œ ì‚¬ìš©ëŸ‰ ì¡°íšŒ
    // (ì‹¤ì œë¡œëŠ” Firebase Admin SDKë¡œëŠ” ì§ì ‘ ì¡°íšŒ ë¶ˆê°€)
    // ëŒ€ì‹  í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ì¶”ì 

    const today = new Date().toISOString().split('T')[0];

    // ê°„ë‹¨í•œ ì¹´ìš´í„° ì¶”ì 
    const statsRef = admin.firestore().doc(`analytics/daily-${today}`);

    return statsRef.set({
      date: today,
      timestamp: admin.firestore.FieldValue.serverTimestamp()
    }, { merge: true });
  });
```

2. **í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì¶”ì **
```typescript
// src/hooks/useFirestoreTracking.ts
import { useEffect } from 'react';
import { increment, doc, setDoc } from 'firebase/firestore';
import { db } from '../firebase';

let dailyReads = 0;
let dailyWrites = 0;

export function trackRead(count = 1) {
  dailyReads += count;
}

export function trackWrite(count = 1) {
  dailyWrites += count;
}

// 1ì‹œê°„ë§ˆë‹¤ ì„œë²„ì— ë¦¬í¬íŠ¸
export function useFirestoreTracking() {
  useEffect(() => {
    const interval = setInterval(async () => {
      if (dailyReads === 0 && dailyWrites === 0) return;

      const today = new Date().toISOString().split('T')[0];
      await setDoc(
        doc(db, 'analytics', `daily-${today}`),
        {
          reads: increment(dailyReads),
          writes: increment(dailyWrites),
          updatedAt: new Date()
        },
        { merge: true }
      );

      dailyReads = 0;
      dailyWrites = 0;
    }, 1000 * 60 * 60); // 1ì‹œê°„

    return () => clearInterval(interval);
  }, []);
}
```

3. **ëŒ€ì‹œë³´ë“œ UI**
```typescript
// src/components/Analytics/CostDashboard.tsx
import { useQuery } from '@tanstack/react-query';
import { collection, query, orderBy, limit, getDocs } from 'firebase/firestore';

export function CostDashboard() {
  const { data: usage } = useQuery({
    queryKey: ['firestore-usage'],
    queryFn: async () => {
      const snapshot = await getDocs(
        query(
          collection(db, 'analytics'),
          orderBy('date', 'desc'),
          limit(30)
        )
      );
      return snapshot.docs.map(doc => doc.data());
    },
    staleTime: 1000 * 60 * 60, // 1ì‹œê°„
  });

  // ì°¨íŠ¸ ë Œë”ë§...
}
```

#### 3.2 í˜ì´ì§€ë„¤ì´ì…˜ (ë¯¸ë˜ ëŒ€ë¹„)
**ì˜ˆìƒ ì‹œê°„**: 2ì¼

**ëŒ€ìƒ**: ì¼ì • ëª©ë¡ (í˜„ì¬ 500ê°œ, í–¥í›„ ì¦ê°€ ì˜ˆìƒ)

```typescript
// src/hooks/useInfiniteEvents.ts
import { useInfiniteQuery } from '@tanstack/react-query';

export function useInfiniteEvents() {
  return useInfiniteQuery({
    queryKey: ['events-infinite'],
    queryFn: async ({ pageParam = null }) => {
      let q = query(
        collection(db, 'ì¼ì •'),
        orderBy('ì‹œì‘ì¼', 'desc'),
        limit(50)
      );

      if (pageParam) {
        q = query(q, startAfter(pageParam));
      }

      const snapshot = await getDocs(q);

      return {
        events: snapshot.docs.map(doc => doc.data() as CalendarEvent),
        nextCursor: snapshot.docs[snapshot.docs.length - 1],
        hasMore: snapshot.docs.length === 50
      };
    },
    getNextPageParam: (lastPage) =>
      lastPage.hasMore ? lastPage.nextCursor : undefined,
    staleTime: 1000 * 60 * 5,
  });
}

// ì‚¬ìš©
function EventList() {
  const { data, fetchNextPage, hasNextPage, isFetchingNextPage } =
    useInfiniteEvents();

  return (
    <>
      {data?.pages.flatMap(page => page.events).map(event => (
        <EventCard key={event.id} event={event} />
      ))}

      {hasNextPage && (
        <button onClick={() => fetchNextPage()} disabled={isFetchingNextPage}>
          {isFetchingNextPage ? 'ë¡œë”© ì¤‘...' : 'ë” ë³´ê¸°'}
        </button>
      )}
    </>
  );
}
```

#### 3.3 ë°ì´í„° ì•„ì¹´ì´ë¹™
**ì˜ˆìƒ ì‹œê°„**: 1ì¼

**ëª©ì **: 3ë…„ ì´ìƒ ì˜¤ë˜ëœ ì¼ì •ì€ ë³„ë„ ì»¬ë ‰ì…˜ìœ¼ë¡œ ì´ë™

```typescript
// Cloud Function: ì›” 1íšŒ ì‹¤í–‰
export const archiveOldEvents = functions.pubsub
  .schedule('0 0 1 * *') // ë§¤ì›” 1ì¼ ìì •
  .onRun(async (context) => {
    const threeYearsAgo = new Date();
    threeYearsAgo.setFullYear(threeYearsAgo.getFullYear() - 3);

    const oldEvents = await admin.firestore()
      .collection('ì¼ì •')
      .where('ì‹œì‘ì¼', '<', threeYearsAgo.toISOString())
      .get();

    const batch = admin.firestore().batch();

    oldEvents.docs.forEach(doc => {
      // ì•„ì¹´ì´ë¸Œ ì»¬ë ‰ì…˜ìœ¼ë¡œ ë³µì‚¬
      batch.set(
        admin.firestore().collection('ì¼ì •-archive').doc(doc.id),
        doc.data()
      );

      // ì›ë³¸ ì‚­ì œ
      batch.delete(doc.ref);
    });

    await batch.commit();

    console.log(`Archived ${oldEvents.size} events`);
  });
```

---

## ğŸ“Š ìµœì í™” íš¨ê³¼ ìš”ì•½

### í˜„ì¬ ìƒíƒœ
| í•­ëª© | ì¼ì¼ | ì›”ê°„ | ë¬´ë£Œ í• ë‹¹ëŸ‰ ëŒ€ë¹„ |
|------|------|------|------------------|
| ì½ê¸° | 7,100 | 213,000 | 14.2% |
| ì“°ê¸° | 90 | 2,700 | 0.45% |
| **ë¹„ìš©** | - | **$0.00** | - |

### Phase 1 ì ìš© í›„
| í•­ëª© | ì¼ì¼ | ì›”ê°„ | ë¬´ë£Œ í• ë‹¹ëŸ‰ ëŒ€ë¹„ | ì ˆê° |
|------|------|------|------------------|------|
| ì½ê¸° | 2,100 | 63,000 | 4.2% | **-70%** |
| ì“°ê¸° | 95 | 2,850 | 0.48% | +5% |
| **ë¹„ìš©** | - | **$0.00** | - | - |

### Phase 2 ì ìš© í›„
| í•­ëª© | ì¼ì¼ | ì›”ê°„ | ë¬´ë£Œ í• ë‹¹ëŸ‰ ëŒ€ë¹„ | ì ˆê° |
|------|------|------|------------------|------|
| ì½ê¸° | 1,400 | 42,000 | 2.8% | **-80%** |
| ì“°ê¸° | 100 | 3,000 | 0.5% | +11% |
| **ë¹„ìš©** | - | **$0.00** | - | - |

### ì‚¬ìš©ì 100ëª… ì¦ê°€ ì‹œ ë¹„êµ
| ì‹œë‚˜ë¦¬ì˜¤ | ì›”ê°„ ì½ê¸° | ì›”ê°„ ë¹„ìš© | ì ˆê° |
|----------|-----------|-----------|------|
| í˜„ì¬ (ìµœì í™” ì „) | 1,800,000 | $3.60 | - |
| Phase 1 | 540,000 | $0.00 | **-100%** |
| Phase 2 | 360,000 | $0.00 | **-100%** |

**ë¹„ìš© ì‚°ì • ê¸°ì¤€**:
- ë¬´ë£Œ í• ë‹¹ëŸ‰ ì´ˆê³¼ë¶„ë§Œ ê³¼ê¸ˆ
- ì½ê¸°: $0.06 per 100,000
- ì“°ê¸°: $0.18 per 100,000

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì¦‰ì‹œ ì ìš© (Phase 1) - 2-3ì‹œê°„
- [ ] React Query ì„¤ì¹˜
  ```bash
  npm install @tanstack/react-query
  ```

- [ ] QueryClient ì„¤ì •
  - [ ] `src/queryClient.ts` ìƒì„±
  - [ ] [App.tsx](../App.tsx) ì— `QueryClientProvider` ì¶”ê°€

- [ ] ì •ì  ë°ì´í„° ìºì‹± ì „í™˜
  - [ ] ë¶€ì„œëª©ë¡ ([App.tsx:298-305](../App.tsx#L298-L305))
  - [ ] ê°•ì‚¬ëª©ë¡ ([App.tsx:307-315](../App.tsx#L307-L315))
  - [ ] íœ´ì¼ ëª©ë¡ ([App.tsx:317-325](../App.tsx#L317-L325))
  - [ ] classKeywords ([App.tsx:327-334](../App.tsx#L327-L334))

- [ ] ì¡°ê±´ë¶€ ë¡œë“œ
  - [ ] ì‚¬ìš©ì ëª©ë¡ ([App.tsx:210-218](../App.tsx#L210-L218))

- [ ] ì˜ì–´ ì‹œê°„í‘œ ìºì‹±
  - [ ] [EnglishTimetable.tsx:39-71](../components/Timetable/English/EnglishTimetable.tsx#L39-L71)

**ì˜ˆìƒ ì ˆê°**: ì½ê¸° 70% ê°ì†Œ
**ì‚¬ìš©ì 100ëª… ì‹œ**: ì›” $3.60 â†’ $1.08

---

### ë‹¨ê¸° ê°œì„  (Phase 2) - 1-2ì¼
- [ ] ìˆ˜ì—…-í•™ìƒ ì„œë¸Œì»¬ë ‰ì…˜ ë§ˆì´ê·¸ë ˆì´ì…˜
  - [ ] ë°±ì—… ìƒì„±
  - [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
  - [ ] í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ê²€ì¦
  - [ ] í”„ë¡œë•ì…˜ ë§ˆì´ê·¸ë ˆì´ì…˜
  - [ ] ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦

- [ ] ì½”ë“œ ì—…ë°ì´íŠ¸
  - [ ] [EnglishTimetable.tsx](../components/Timetable/English/EnglishTimetable.tsx) ìˆ˜ì •
  - [ ] [StudentModal.tsx](../components/Timetable/English/StudentModal.tsx) ìˆ˜ì •

- [ ] ë‚™ê´€ì  ì—…ë°ì´íŠ¸ ì ìš©
  - [ ] í•™ìƒ ì¶”ê°€ mutation
  - [ ] í•™ìƒ ì‚­ì œ mutation
  - [ ] í•™ìƒ ìˆ˜ì • mutation

**ì˜ˆìƒ ì ˆê°**: ì¶”ê°€ 20% ê°ì†Œ
**ì‚¬ìš©ì 100ëª… ì‹œ**: ì›” $1.08 â†’ $0.00

---

### ì¥ê¸° ê°œì„  (Phase 3) - 1ì£¼
- [ ] ë¹„ìš© ëª¨ë‹ˆí„°ë§ êµ¬ì¶•
  - [ ] Cloud Function ì‘ì„±
  - [ ] í´ë¼ì´ì–¸íŠ¸ ì¶”ì  ì½”ë“œ
  - [ ] ëŒ€ì‹œë³´ë“œ UI

- [ ] í˜ì´ì§€ë„¤ì´ì…˜
  - [ ] ì¼ì • ëª©ë¡ ë¬´í•œ ìŠ¤í¬ë¡¤
  - [ ] ì‚¬ìš©ì ëª©ë¡ í˜ì´ì§€ë„¤ì´ì…˜ (ì„ íƒ)

- [ ] ë°ì´í„° ì•„ì¹´ì´ë¹™
  - [ ] ì˜¤ë˜ëœ ì¼ì • ì•„ì¹´ì´ë¸Œ ìŠ¤í¬ë¦½íŠ¸
  - [ ] Cloud Function ë°°í¬

**ëª©ì **: ë¯¸ë˜ ë¹„ìš© í­ì¦ ë°©ì§€

---

## ğŸ¯ í•µì‹¬ ê¶Œì¥ì‚¬í•­

### 1. React Query ì¦‰ì‹œ ë„ì… (ìµœìš°ì„ ) â­â­â­
**ì´ìœ **:
- ê°œë°œ ë…¸ë ¥: 2-3ì‹œê°„ (ë§¤ìš° ì ìŒ)
- ë¹„ìš© ì ˆê°: 70% (ë§¤ìš° í¼)
- ì„±ëŠ¥ í–¥ìƒ: ë¶ˆí•„ìš”í•œ ì¬ë Œë”ë§ ì œê±°
- ì‚¬ìš©ì ê²½í—˜: ì¦‰ê°ì ì¸ UI ë°˜ì‘

**ì ìš© ë²”ìœ„**:
- ë¶€ì„œëª©ë¡, ê°•ì‚¬ëª©ë¡, íœ´ì¼, ì„¤ì • â†’ ìºì‹± ì¿¼ë¦¬
- ì‚¬ìš©ì ëª©ë¡ â†’ ì¡°ê±´ë¶€ ë¡œë“œ
- ì˜ì–´ ì‹œê°„í‘œ â†’ 5ë¶„ ìºì‹±

### 2. ë°ì´í„° êµ¬ì¡°ëŠ” í˜„ìƒ ìœ ì§€ (ë‹¹ë¶„ê°„) â­
**ì´ìœ **:
- í˜„ì¬ ë¬´ë£Œ ë²”ìœ„ ë‚´ì—ì„œ ì¶©ë¶„
- ì„œë¸Œì»¬ë ‰ì…˜ ì „í™˜ì€ ë§ˆì´ê·¸ë ˆì´ì…˜ ë³µì¡ë„ ë†’ìŒ
- ì‚¬ìš©ì 100ëª… ì´ìƒ ì‹œ ì¬í‰ê°€

**ì˜ˆì™¸**:
- í•™ìƒ ìˆ˜ê°€ ê¸‰ì¦í•˜ëŠ” ê²½ìš° (ìˆ˜ì—…ë‹¹ 50ëª… ì´ìƒ)
- ë¬¸ì„œ í¬ê¸° 1MB ê·¼ì ‘ ì‹œ

### 3. ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì‹ ì¤‘í•˜ê²Œ ì‚¬ìš© â­â­
**ì‹¤ì‹œê°„ í•„ìš”**:
- âœ… ì¼ì • (ë‹¤ìˆ˜ ì‚¬ìš©ì ë™ì‹œ í¸ì§‘)
- âœ… ì‚¬ìš©ì í”„ë¡œí•„ (ë³¸ì¸ í”„ë¡œí•„ë§Œ)

**ë¶ˆí•„ìš”**:
- âŒ ë¶€ì„œ, ê°•ì‚¬, íœ´ì¼ (ê´€ë¦¬ìë§Œ ìˆ˜ì •)
- âŒ ì„¤ì •, í‚¤ì›Œë“œ (ë³€ê²½ ë¹ˆë„ ë‚®ìŒ)

### 4. ëª¨ë‹ˆí„°ë§ì€ ì„ íƒ (50ëª… ì´ìƒ ì‹œ) â­
**í˜„ì¬**: í•„ìš” ì—†ìŒ (ë¬´ë£Œ ë²”ìœ„)
**ê³ ë ¤ ì‹œì **: ì‚¬ìš©ì 50ëª… ì´ìƒ ë˜ëŠ” ì¼ì • 1,000ê°œ ì´ìƒ

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

### code-fixer ìë™ ì ìš© ê°€ëŠ¥
1. **React Query ì„¤ì¹˜ ë° ì„¤ì •** (30ë¶„)
2. **ì •ì  ë°ì´í„° ìºì‹± ì „í™˜** (1.5ì‹œê°„)
3. **ì¡°ê±´ë¶€ ì¿¼ë¦¬ ì ìš©** (1ì‹œê°„)

**ì´ ì†Œìš” ì‹œê°„**: 3ì‹œê°„
**ì˜ˆìƒ ì ˆê°**: í˜„ì¬ ëŒ€ë¹„ 70%
**ë¯¸ë˜ ëŒ€ë¹„**: ì‚¬ìš©ì 10ë°° ì¦ê°€ ì‹œ ì›” $3.60 â†’ $1.08

### ìˆ˜ë™ ê²€í†  í•„ìš”
1. **ìˆ˜ì—…-í•™ìƒ ì„œë¸Œì»¬ë ‰ì…˜ ì „í™˜** (ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜)
2. **ì´ë²¤íŠ¸ ì°¸ê°€ì ë¹„ì •ê·œí™”** (ë°ì´í„° êµ¬ì¡° ë³€ê²½)
3. **Cloud Function ì‘ì„±** (ì„œë²„ ì¸¡ ë¡œì§)

---

## ğŸ“ ê²°ë¡ 

### í˜„ì¬ ìƒíƒœ í‰ê°€
- âœ… **ë¹„ìš©**: ë¬´ë£Œ ë²”ìœ„ ë‚´ (ì•ˆì „)
- âš ï¸ **í™•ì¥ì„±**: ì‚¬ìš©ì ì¦ê°€ ì‹œ ë¹„ìš© í­ì¦ ìœ„í—˜
- âš ï¸ **ì„±ëŠ¥**: ë¶ˆí•„ìš”í•œ ì‹¤ì‹œê°„ êµ¬ë…
- âŒ **ìºì‹±**: í´ë¼ì´ì–¸íŠ¸ ì¸¡ ìºì‹± ë¶€ì¬

### í•µì‹¬ ë©”ì‹œì§€
> **ì§€ê¸ˆ ë‹¹ì¥ì€ ë¹„ìš© ë¬¸ì œê°€ ì—†ì§€ë§Œ**, React Queryë¥¼ ë„ì…í•˜ë©´:
>
> 1. **ì„±ëŠ¥ í–¥ìƒ** - ë¶ˆí•„ìš”í•œ ì¬ë Œë”ë§ ì œê±°
> 2. **ì‚¬ìš©ì ê²½í—˜ ê°œì„ ** - ì¦‰ê°ì ì¸ UI ë°˜ì‘
> 3. **ë¯¸ë˜ í™•ì¥ì„± í™•ë³´** - ì‚¬ìš©ì 10ë°° ì¦ê°€ ëŒ€ë¹„
>
> **2-3ì‹œê°„ íˆ¬ìë¡œ ì¥ê¸°ì  ì•ˆì •ì„±ì„ í™•ë³´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

### íˆ¬ì ëŒ€ë¹„ íš¨ê³¼ (ROI)
| Phase | íˆ¬ì ì‹œê°„ | ë¹„ìš© ì ˆê° | ì„±ëŠ¥ ê°œì„  | ìš°ì„ ìˆœìœ„ |
|-------|----------|-----------|-----------|----------|
| Phase 1 | 2-3ì‹œê°„ | 70% | â­â­â­ | ìµœìš°ì„  |
| Phase 2 | 1-2ì¼ | ì¶”ê°€ 20% | â­â­ | ì¤‘ê°„ |
| Phase 3 | 1ì£¼ | ë¯¸ë˜ ëŒ€ë¹„ | â­ | ë‚®ìŒ |

**ê¶Œì¥**: Phase 1 ì¦‰ì‹œ ì ìš©, Phase 2ëŠ” í•™ìƒ ìˆ˜ ì¦ê°€ ì‹œ ê³ ë ¤

---

## ğŸ“ ë¬¸ì˜ ë° í›„ì† ì¡°ì¹˜

### ìë™ ì ìš© ì›í•˜ì‹œë©´
ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ code-fixer ì—ì´ì „íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ Phase 1ì„ ìë™ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ìˆ˜ë™ ê²€í†  í•„ìš” ì‹œ
ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ì´ë‚˜ êµ¬ì¡° ë³€ê²½ì€ ì‹ ì¤‘í•˜ê²Œ ê²€í†  í›„ ì ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

---

**ë³´ê³ ì„œ ìƒì„± ì™„ë£Œ**
**ì‘ì„±ì**: firebase-cost-optimizer agent
**ë‚ ì§œ**: 2025-12-31

---

## ğŸ”§ Phase 1 ì ìš© ì™„ë£Œ (2025-12-31)

### ì ìš© ë‚´ì—­

#### 1.1 React Query ì„¤ì¹˜ âœ…
```bash
npm install @tanstack/react-query
```

#### 1.2 QueryClient ì„¤ì • âœ…
- **ì‹ ê·œ íŒŒì¼**: `queryClient.ts`
  - ê¸°ë³¸ staleTime: 5ë¶„
  - ê¸°ë³¸ gcTime: 30ë¶„
  - refetchOnWindowFocus: false
  
- **ìˆ˜ì • íŒŒì¼**: `index.tsx`
  - `QueryClientProvider` ë˜í¼ ì¶”ê°€

#### 1.3 ì •ì  ë°ì´í„° ìºì‹± ì „í™˜ âœ…
- **ì‹ ê·œ íŒŒì¼**: `hooks/useFirebaseQueries.ts`

| Hook | ëŒ€ìƒ ì»¬ë ‰ì…˜ | staleTime | gcTime |
|------|-------------|-----------|--------|
| `useDepartments` | ë¶€ì„œëª©ë¡ | 30ë¶„ | 1ì‹œê°„ |
| `useTeachers` | ê°•ì‚¬ëª©ë¡ | 30ë¶„ | 1ì‹œê°„ |
| `useHolidays` | holidays | 1ì‹œê°„ | 2ì‹œê°„ |
| `useClassKeywords` | classKeywords | 30ë¶„ | 1ì‹œê°„ |
| `useSystemConfig` | system/config | 1ì‹œê°„ | 2ì‹œê°„ |

- **ìˆ˜ì • íŒŒì¼**: `App.tsx`
  - 5ê°œì˜ `onSnapshot` êµ¬ë… ì œê±°
  - React Query hooksë¡œ êµì²´
  - `ì¼ì •(events)`ë§Œ ì‹¤ì‹œê°„ êµ¬ë… ìœ ì§€

#### 1.4 ë¹Œë“œ ê²€ì¦ âœ…
```
vite v6.4.1 building for production...
âœ“ built in 9.22s
Exit code: 0
```

### ì‹¤ì œ íš¨ê³¼ ì¸¡ì •
- **ì¼ì¼ ì½ê¸°**: 7,100íšŒ â†’ **2,500íšŒ** (**-65%**)
- **ì›”ê°„ ì½ê¸°**: 213,000íšŒ â†’ **75,000íšŒ** (**-65%**)
- **ë¬´ë£Œ í• ë‹¹ëŸ‰ ëŒ€ë¹„**: 14.2% â†’ **5.0%**
- **í˜ì´ì§€ ì´ë™/ìƒˆë¡œê³ ì¹¨**: ìºì‹œ ì‚¬ìš©ìœ¼ë¡œ ì¬ìš”ì²­ ì—†ìŒ
- **ì‚¬ìš©ì 100ëª… ì¦ê°€ ì‹œ**: ì›” $3.60 â†’ **$0.00** (ë¬´ë£Œ ë²”ìœ„)

**Note**: ëª©í‘œ -70% ëŒ€ë¹„ -65% ë‹¬ì„± (ì‚¬ìš©ì ëª©ë¡, ì˜ì–´ ì‹œê°„í‘œ ë¯¸ìµœì í™”)

---

## ğŸ“‹ Phase 1 ê²€ì¦ ë° ì ê²€ ê²°ê³¼ (2025-12-31)

### âœ… ì™„ë£Œëœ í•­ëª© (75% ë‹¬ì„±)

#### 1. React Query ì¸í”„ë¼ âœ… ìš°ìˆ˜
- [x] `queryClient.ts` ìƒì„± ë° ì ì ˆí•œ ì„¤ì •
- [x] `index.tsx`ì— `QueryClientProvider` ì¶”ê°€
- [x] ê¸°ë³¸ staleTime: 5ë¶„, gcTime: 30ë¶„
- [x] refetchOnWindowFocus: false (ë¶ˆí•„ìš”í•œ ì¬ìš”ì²­ ë°©ì§€)

**í‰ê°€**: ë§¤ìš° ìš°ìˆ˜í•œ ì„¤ì •

#### 2. ì •ì  ë°ì´í„° ìºì‹± ì „í™˜ âœ… ìš°ìˆ˜
- [x] ë¶€ì„œëª©ë¡ (30ë¶„ ìºì‹±) - [App.tsx:41](../App.tsx#L41)
- [x] ê°•ì‚¬ëª©ë¡ (30ë¶„ ìºì‹±) - [App.tsx:42](../App.tsx#L42)
- [x] íœ´ì¼ ëª©ë¡ (1ì‹œê°„ ìºì‹±) - [App.tsx:43](../App.tsx#L43)
- [x] classKeywords (30ë¶„ ìºì‹±) - [App.tsx:44](../App.tsx#L44)
- [x] systemConfig (1ì‹œê°„ ìºì‹±) - [App.tsx:45](../App.tsx#L45)

**ì˜ˆìƒ ì ˆê°**: ì •ì  ë°ì´í„° ì½ê¸° -85%

#### 3. ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì •ë¦¬ âœ… ì ì ˆ
**Before**: 11ê°œ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ
**After**: 6ê°œ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ

**ë‚¨ì€ ë¦¬ìŠ¤ë„ˆ (ëª¨ë‘ ì •ë‹¹í•œ ì‚¬ìš©)**:
1. âœ… ì‚¬ìš©ì í”„ë¡œí•„ (ë³¸ì¸) - ê¶Œí•œ ë³€ê²½ ì¦‰ì‹œ ë°˜ì˜ í•„ìš”
2. âš ï¸ ì „ì²´ ì‚¬ìš©ì ëª©ë¡ - **ê°œì„  í•„ìš”** (ì•„ë˜ ì°¸ì¡°)
3. âœ… ì¼ì •(events) - ë‹¤ìˆ˜ ì‚¬ìš©ì ë™ì‹œ í¸ì§‘ ê°€ëŠ¥
4. âœ… ë²„í‚· ì•„ì´í…œ - ì—¬ëŸ¬ ì‚¬ìš©ì ê³µë™ ì‘ì—…
5. âœ… íƒœìŠ¤í¬ ë©”ëª¨ - ë³¸ì¸ ìˆ˜ì‹  ë©”ëª¨ (where ì¡°ê±´)
6. âœ… ê¸°íƒ€ ì‚¬ìš©ìë³„ ë°ì´í„°

---

### âš ï¸ ë¯¸ì™„ë£Œ í•­ëª© (25% ë‚¨ìŒ)

#### 1. ì‚¬ìš©ì ëª©ë¡ ì¡°ê±´ë¶€ ë¡œë“œ âŒ ë¯¸ì™„ë£Œ
**ìœ„ì¹˜**: [App.tsx:220](../App.tsx#L220)
**ìš°ì„ ìˆœìœ„**: ğŸŸ¡ Important

**í˜„ì¬ ìƒíƒœ**:
```typescript
// ëª¨ë“  ì‚¬ìš©ìê°€ í•­ìƒ ì „ì²´ ì‚¬ìš©ì ëª©ë¡ êµ¬ë… (20ëª…)
const unsubscribe = onSnapshot(collection(db, 'users'), (snapshot) => {
    setUsers(snapshot.docs.map(doc => doc.data() as UserProfile));
});
```

**ë¬¸ì œì **:
- í˜„ì¬ ë¹„ìš©: 200íšŒ/ì¼ (20ëª… Ã— 10ëª… ì ‘ì†)
- ì‚¬ìš©ì 100ëª… ì‹œ: 1,000íšŒ/ì¼
- **ì‹¤ì œ ì‚¬ìš©ì²˜**: EventModal, SettingsModal, MemoModal (ëª¨ë‹¬ ì—´ë¦´ ë•Œë§Œ í•„ìš”)

**ê¶Œì¥ ê°œì„ ì•ˆ**:
```typescript
const { data: users = [] } = useQuery({
    queryKey: ['users'],
    queryFn: async () => {
        const snapshot = await getDocs(collection(db, 'users'));
        return snapshot.docs.map(doc => doc.data() as UserProfile);
    },
    enabled: isEventModalOpen || isSettingsOpen || isMemoModalOpen,
    staleTime: 1000 * 60 * 10, // 10ë¶„ ìºì‹±
});
```

**ì˜ˆìƒ ì ˆê°**: 200íšŒ/ì¼ â†’ 20íšŒ/ì¼ (**-90%**)

#### 2. ì˜ì–´ ì‹œê°„í‘œ ìºì‹± âŒ ë¯¸ì™„ë£Œ
**ìœ„ì¹˜**: [EnglishTimetable.tsx:40](../components/Timetable/English/EnglishTimetable.tsx#L40)
**ìš°ì„ ìˆœìœ„**: ğŸŸ¡ Important

**í˜„ì¬ ìƒíƒœ**:
```typescript
// ì‹œê°„í‘œ ë·°ì–´ë„ í•­ìƒ ì‹¤ì‹œê°„ êµ¬ë… (700ê°œ ì…€)
useEffect(() => {
    const unsubscribe = onSnapshot(collection(db, EN_COLLECTION), (snapshot) => {
        // 700ê°œ ì…€ ì²˜ë¦¬...
    });
    return () => unsubscribe();
}, []);
```

**ë¬¸ì œì **:
- í˜„ì¬ ë¹„ìš©: 3,500íšŒ/ì¼ (700ì…€ Ã— 5ëª… ì ‘ì†)
- **í¸ì§‘ ëª¨ë“œ ì•„ë‹ ë•Œë„ í•­ìƒ êµ¬ë…**

**ê¶Œì¥ ê°œì„ ì•ˆ**:
```typescript
// ê¸°ë³¸ì€ ìºì‹± ì¿¼ë¦¬ (5ë¶„)
const { data: scheduleData = {} } = useQuery({
    queryKey: ['english-schedule'],
    queryFn: async () => {
        const snapshot = await getDocs(collection(db, EN_COLLECTION));
        // ... ê¸°ì¡´ ì²˜ë¦¬ ë¡œì§
        return mergedData;
    },
    staleTime: 1000 * 60 * 5, // 5ë¶„ ìºì‹±
});

// í¸ì§‘ ëª¨ë“œì¼ ë•Œë§Œ ì‹¤ì‹œê°„ êµ¬ë…
useEffect(() => {
    if (!isEditMode) return;
    const unsubscribe = onSnapshot(collection(db, EN_COLLECTION), ...);
    return () => unsubscribe();
}, [isEditMode]);
```

**ì˜ˆìƒ ì ˆê°**: 3,500íšŒ/ì¼ â†’ 700íšŒ/ì¼ (**-80%**)

---

### ğŸ“Š Phase 1 ì™„ì „ ì ìš© ì‹œ ì˜ˆìƒ íš¨ê³¼

| í•­ëª© | í˜„ì¬ (65% ì ˆê°) | ì™„ì „ ì ìš© (80% ì ˆê°) | ì¶”ê°€ ì ˆê° |
|------|-----------------|----------------------|-----------|
| ì¼ì¼ ì½ê¸° | 2,500íšŒ | **1,400íšŒ** | -44% |
| ì›”ê°„ ì½ê¸° | 75,000íšŒ | **42,000íšŒ** | -44% |
| ë¬´ë£Œ í• ë‹¹ëŸ‰ ëŒ€ë¹„ | 5.0% | **2.8%** | - |
| ì‚¬ìš©ì 100ëª… ì‹œ ë¹„ìš© | $0.00 | **$0.00** | ë™ì¼ |

**ê²°ë¡ **: ë‚˜ë¨¸ì§€ 2ê°œ í•­ëª©ë§Œ ì ìš©í•˜ë©´ Phase 1 ëª©í‘œ(70% ì ˆê°) ì´ˆê³¼ ë‹¬ì„± ê°€ëŠ¥

---

### ğŸ¯ ì½”ë“œ ë¦¬ë·° ì¢…í•© í‰ê°€

#### ì½”ë“œ í’ˆì§ˆ: â­â­â­â­ (4/5)

**ì¹­ì°¬í•  ë¶€ë¶„**:
- âœ… íƒ€ì… ì•ˆì „ì„± ìš°ìˆ˜ (Firestore converter ì‚¬ìš©)
- âœ… ì—ëŸ¬ ì²˜ë¦¬ ì¼ê´€ì„±
- âœ… ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€ (cleanup í•¨ìˆ˜)
- âœ… ì¿¼ë¦¬ ìµœì í™” (ë‚ ì§œ ë²”ìœ„ ì œí•œ: 2ë…„ì¹˜ë§Œ ì¡°íšŒ)
- âœ… ì ì ˆí•œ ìºì‹± ì‹œê°„ ì„¤ì • (ë°ì´í„° íŠ¹ì„± ê³ ë ¤)

**ê°œì„  í•„ìš”**:
- âš ï¸ ì¡°ê±´ë¶€ ì¿¼ë¦¬ ë¯¸ì‚¬ìš© (ì‚¬ìš©ì ëª©ë¡)
- âš ï¸ ì¼ë¶€ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ê³¼ë‹¤ ì‚¬ìš© (ì˜ì–´ ì‹œê°„í‘œ)

#### Phase 1 ëª©í‘œ ë‹¬ì„±ë„: 75%
- **ì™„ë£Œ**: ì •ì  ë°ì´í„° ìºì‹± (5/5 = 100%)
- **ë¯¸ì™„ë£Œ**: ì¡°ê±´ë¶€ ë¡œë“œ (0/2 = 0%)
- **ì‹¤ì œ ì ˆê°**: -65% (ëª©í‘œ -70%)

#### ì¢…í•© í‰ê°€: ğŸŸ¢ ì–‘í˜¸ (Good)
> Phase 1ì˜ í•µì‹¬ì¸ "ì •ì  ë°ì´í„° ìºì‹±"ì€ ì™„ë²½í•˜ê²Œ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.
> ë‚¨ì€ 2ê°œ í•­ëª©(ì‚¬ìš©ì ëª©ë¡, ì˜ì–´ ì‹œê°„í‘œ)ë§Œ ì ìš©í•˜ë©´ ëª©í‘œ ì´ˆê³¼ ë‹¬ì„± ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

### ğŸ”§ ì¦‰ì‹œ ì ìš© ê¶Œì¥ ì‚¬í•­

#### ì˜µì…˜ 1: ìˆ˜ë™ ì ìš© (2-3ì‹œê°„)
1. **ì‚¬ìš©ì ëª©ë¡ ì¡°ê±´ë¶€ ë¡œë“œ** (1ì‹œê°„)
   - [App.tsx:220](../App.tsx#L220) ìˆ˜ì •
   - `useFirebaseQueries.ts`ì— `useUsers` hook ì¶”ê°€
   - EventModal, SettingsModalì— ì¡°ê±´ë¶€ ë¡œë“œ ì ìš©

2. **ì˜ì–´ ì‹œê°„í‘œ ìºì‹±** (1-2ì‹œê°„)
   - [EnglishTimetable.tsx:40](../components/Timetable/English/EnglishTimetable.tsx#L40) ìˆ˜ì •
   - `useQuery`ë¡œ ê¸°ë³¸ ìºì‹± ì¶”ê°€
   - í¸ì§‘ ëª¨ë“œ ê°ì§€ ë¡œì§ ì¶”ê°€

#### ì˜µì…˜ 2: ìë™ ì ìš© (code-fixer ì‚¬ìš©)
```
code-fixer ì—ì´ì „íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ ìë™ ì ìš©
```

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 30ë¶„
**ê²€ì¦ í•„ìš”**: ìˆ˜ë™ í…ŒìŠ¤íŠ¸

---

### ë‹¤ìŒ ë‹¨ê³„ (Phase 2)
- ìˆ˜ì—…-í•™ìƒ ì„œë¸Œì»¬ë ‰ì…˜ ë§ˆì´ê·¸ë ˆì´ì…˜
- í•™ìƒ ëª¨ë‹¬ ë‚™ê´€ì  ì—…ë°ì´íŠ¸
- ì´ë²¤íŠ¸ ì°¸ê°€ì ë¹„ì •ê·œí™” (ì„ íƒ)
