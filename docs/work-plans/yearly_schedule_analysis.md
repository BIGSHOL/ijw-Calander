# 연간 일정(Yearly Schedule) 탭 정밀 분석 보고서

## 1. 🔍 현재 구조 및 데이터 흐름

- **데이터 소스**: `App.tsx` 최상위 레벨에서 `onSnapshot`으로 구독
- **쿼리 조건**: 시작일 >= `현재 - 2년` (설정값 `eventLookbackYears`에 따름)
- **컴포넌트**: `App -> CalendarBoard -> YearlyView` (Props로 전체 이벤트 전달)

## 2. ⚠️ 잠재적 문제점 및 버그 가능성

### A. 과거 데이터 조회 제한 (Functional Limit)
- **현상**: 사용자가 연간 뷰에서 ` < ` 버튼을 눌러 **2년 전보다 더 이전의 연도**로 이동하면, 일정이 하나도 표시되지 않습니다.
- **이유**: `App.tsx`의 쿼리가 `where("시작일", ">=", queryStartDate)`로 하드코딩 되어 있기 때문입니다.
- **위험도**: 🟡 중간 (사용자가 과거 기록을 보려 할 때 "데이터 소실"로 오해 가능)

### B. 초기 로딩 및 메모리 비용 (Performance)
- **현상**: 매번 앱 실행 시 **최근 2년치 모든 일정**을 다운로드합니다.
- **예시**: 하루 10개 일정 × 730일 = **7,300개 문서 Read**.
- **비용**: 사용자가 연간 뷰를 안 봐도, 앱을 켜기만 하면 청구됩니다.
- **위험도**: 🔴 높음 (Firebase 읽기 비용의 숨겨진 주범 가능성)

### C. 클라이언트 연산 부하 (Client-Side Load)
- **현상**: `YearlyView`는 7,000+개의 이벤트를 매 렌더링마다 순회하며 `densityMap`(밀도 맵)을 다시 계산합니다.
- **위험도**: 🟡 중간 (저사양 기기에서 연도 이동 시 버벅임 가능성)

---

## 3. 💡 개선 제안 (클라우드 펑션 도입 기회)

### 🚀 제안 1: 오래된 일정 자동 아카이빙 (강력 추천)
**Cloud Function 도입:** `archiveOldEvents` (매일 밤 실행)
- **기능**: 완료된 지 2년 지난 일정을 `archived_events` 컬렉션으로 이동.
- **효과**: 메인 `events` 컬렉션 크기를 작게 유지 → **앱 구동 속도 향상 & 읽기 비용 영구 절감**.
- **필요 시**: "지난 기록 보기" 버튼을 누를 때만 아카이브 로드.

### 🚀 제안 2: 연간 통계 미리 계산
**Cloud Function 도입:** `calculateYearlyStats` (일정 변경 시 트리거)
- **기능**: 연간 뷰에 필요한 "날짜별 일정 개수"만 계산하여 별도 문서(`stats_yyyy_mm`)에 저장.
- **효과**: `YearlyView`에서 7,000개 이벤트를 로딩할 필요 없이, 가벼운 통계 문서(숫자만 포함)만 로드.
- **비용 절감**: **~90% 절감 예상** (연간 뷰 진입 시).

---

## 4. ✅ 결론 및 권장사항

1.  **당장 수정 불필요**: 현재 구조도 동작에는 문제없음 (치명적 버그 없음).
2.  **장기적 추천**: **"오래된 일정 아카이빙"** 시스템 도입을 추천합니다. 데이터가 쌓일수록 앱이 느려지는 것을 방지하는 유일한 방법입니다.
