# 역할 시스템 확장: 수학팀장/영어팀장 추가

> 작성일: 2026-01-02
> 최종 수정: 2026-01-02
> 버전: 2.0 (상세 권한 및 사용 가이드 추가)

---

## 목차

1. [개요](#개요)
2. [역할 계층 구조](#역할-계층-구조)
3. [기본 권한 비교](#기본-권한-비교)
4. [전체 권한 목록](#전체-권한-목록)
5. [역할 비교표](#역할-비교표)
6. [사용 시나리오](#사용-시나리오)
7. [설정 방법](#설정-방법)
8. [FAQ](#faq)
9. [수정된 파일](#수정된-파일)
10. [참고사항](#참고사항)

---

## 개요

기존 7단계 역할 시스템을 9단계로 확장하여 **수학팀장(math_lead)**과 **영어팀장(english_lead)** 역할을 추가했습니다.

### 목적
- **과목별 권한 분리**: 수학팀과 영어팀의 시간표를 독립적으로 관리
- **책임 명확화**: 각 팀장은 자신의 과목 시간표만 편집
- **협업 지원**: 수업 목록은 공유하여 학생 데이터 협업 가능

## 역할 계층 구조

```
MASTER → ADMIN → MANAGER → EDITOR → 수학팀장 → 영어팀장 → USER → VIEWER → GUEST
```

## 기본 권한 비교

| 권한 | 수학팀장 | 영어팀장 |
|------|:-------:|:-------:|
| 수학 시간표 보기 | ✅ | ✅ |
| 수학 시간표 편집 | ✅ | ❌ |
| 영어 시간표 보기 | ✅ | ✅ |
| 영어 시간표 편집 | ❌ | ✅ |
| 수업 목록 보기/편집 | ✅ | ✅ |
| 일정 생성/수정(본인) | ✅ | ✅ |
| 출석 관리 | ✅ | ✅ |

---

## 전체 권한 목록

### 공통 권한 (수학팀장 & 영어팀장 동일)

| 권한 ID | 설명 | 값 |
|---------|------|:--:|
| `events.create` | 일정 생성 | ✅ |
| `events.edit_own` | 본인 일정 수정 | ✅ |
| `events.delete_own` | 본인 일정 삭제 | ✅ |
| `events.drag_move` | 일정 드래그 이동 | ✅ |
| `events.attendance` | 출석 관리 | ✅ |
| `departments.view_all` | 모든 부서 보기 | ✅ |
| `system.classes.view` | 수업 목록 보기 | ✅ |
| `system.classes.edit` | 수업 목록 편집 | ✅ |

### 차별화 권한 (팀별 차이)

| 권한 ID | 수학팀장 | 영어팀장 | 설명 |
|---------|:-------:|:-------:|------|
| `timetable.math.view` | ✅ | ✅ | 수학 시간표 보기 |
| `timetable.math.edit` | ✅ | ❌ | 수학 시간표 편집 |
| `timetable.english.view` | ✅ | ✅ | 영어 시간표 보기 |
| `timetable.english.edit` | ❌ | ✅ | 영어 시간표 편집 |

### 제한된 권한 (모두 false)

| 권한 분류 | 권한 ID | 설명 |
|----------|---------|------|
| **타인 일정** | `events.edit_others` | 타인 일정 편집 ❌ |
| | `events.delete_others` | 타인 일정 삭제 ❌ |
| **부서 관리** | `departments.create` | 부서 생성 ❌ |
| | `departments.edit` | 부서 편집 ❌ |
| | `departments.delete` | 부서 삭제 ❌ |
| **사용자 관리** | `users.view` | 사용자 목록 보기 ❌ |
| | `users.approve` | 사용자 승인 ❌ |
| | `users.change_role` | 역할 변경 ❌ |
| | `users.change_permissions` | 권한 변경 ❌ |
| **시스템 설정** | `settings.access` | 설정 접근 ❌ |
| | `settings.holidays` | 공휴일 설정 ❌ |
| | `settings.role_permissions` | 역할 권한 설정 ❌ |
| **버킷 관리** | `buckets.edit_lower_roles` | 하위 역할 버킷 편집 ❌ |
| | `buckets.delete_lower_roles` | 하위 역할 버킷 삭제 ❌ |

---

## 역할 비교표

### 시간표 관련 권한

| 역할 | 수학 시간표 | 영어 시간표 | 통합 시간표 | 시뮬레이션 모드 |
|------|:----------:|:----------:|:-----------:|:-------------:|
| MASTER | 편집 | 편집 | 편집 | ✅ |
| ADMIN | 편집 | 편집 | 편집 | ✅ |
| MANAGER | 보기 | 편집 | 보기 | ✅ |
| EDITOR | 보기 | 보기 | 보기 | ❌ |
| **수학팀장** | **편집** | **보기** | **보기** | **❌** |
| **영어팀장** | **보기** | **편집** | **보기** | **❌** |
| USER | 보기 | 보기 | 보기 | ❌ |

### 일정 관리 권한

| 역할 | 일정 생성 | 본인 일정 편집 | 타인 일정 편집 | 일정 드래그 |
|------|:--------:|:-------------:|:-------------:|:-----------:|
| MANAGER | ✅ | ✅ | ✅ | ✅ |
| EDITOR | ✅ | ✅ | ❌ | ✅ |
| **수학팀장** | **✅** | **✅** | **❌** | **✅** |
| **영어팀장** | **✅** | **✅** | **❌** | **✅** |
| USER | ✅ | ✅ | ❌ | ✅ |

### 핵심 차이점

**팀장 vs EDITOR**:
- ✅ 팀장은 자신의 과목 시간표 편집 가능
- ✅ 팀장은 수업 목록(`system.classes.edit`) 편집 가능
- ❌ EDITOR는 시간표 보기만 가능, 수업 목록 편집 불가

**팀장 vs USER**:
- ✅ 팀장은 시간표 편집 권한 보유
- ✅ 팀장은 수업 목록 편집 권한 보유
- ❌ USER는 시간표 및 수업 목록 보기만 가능

---

## 사용 시나리오

### 시나리오 1: 수학팀장의 하루

**상황**: 수학팀장이 새 학기 준비를 위해 시간표를 조정합니다.

**가능한 작업**:
1. ✅ 수학 시간표 열기 및 편집
2. ✅ 수업 목록에서 학생 추가/삭제
3. ✅ 본인 일정 생성 (팀 회의, 개인 일정)
4. ✅ 영어 시간표 열람 (편집 불가)
5. ✅ 출석 관리 (본인 관련)

**불가능한 작업**:
- ❌ 영어 시간표 편집
- ❌ 타 강사 일정 수정
- ❌ 시뮬레이션 모드 사용
- ❌ 사용자 역할 변경
- ❌ 부서 생성/삭제

### 시나리오 2: 영어팀장의 하루

**상황**: 영어팀장이 신입생을 영어 수업에 배정합니다.

**가능한 작업**:
1. ✅ 영어 시간표 열기 및 편집
2. ✅ 수업 목록에서 학생 추가
3. ✅ StudentModal에서 학생 정보 수정
4. ✅ 본인 부서 일정 생성
5. ✅ 수학 시간표 확인 (편집 불가)

**불가능한 작업**:
- ❌ 수학 시간표 편집
- ❌ 시뮬레이션 모드에서 작업
- ❌ 백업 복원
- ❌ 부서 생성/삭제
- ❌ 타인 버킷 아이템 편집

### 시나리오 3: 권한 충돌 방지

**상황**: 수학팀장과 영어팀장이 동시에 작업

**설계 의도**:
- ✅ 각 팀장은 자신의 과목만 편집 가능
- ✅ 서로의 시간표는 열람만 가능
- ✅ 수업 목록은 공통으로 편집 가능 (학생 데이터 공유)
- ✅ 일정은 본인 것만 수정 가능

**장점**:
- 권한 충돌 없음
- 명확한 책임 분리
- 상호 협력 가능 (수업 목록 공유)

---

## 설정 방법

### 1. 역할 할당

**경로**: 설정 → 사용자 관리

**단계**:
1. 사용자 목록에서 대상 사용자 선택
2. 역할 드롭다운 클릭
3. "수학팀장" 또는 "영어팀장" 선택
4. [저장] 버튼 클릭

**권한**:
- MASTER, ADMIN만 역할 할당 가능
- MANAGER는 역할 변경 불가

### 2. 권한 세부 조정

**경로**: 설정 → 역할 권한

**단계**:
1. "수학팀장" 또는 "영어팀장" 역할 선택
2. 권한 체크박스 ON/OFF
3. [저장] 버튼 클릭

**주의사항**:
- MASTER만 역할 권한 설정 가능
- 변경 사항은 즉시 적용됨
- 로그아웃/로그인 불필요

### 3. 역할 확인

**UI 표시**:
- 헤더 우측 상단: 사용자 이름 옆에 역할 배지 표시
- 설정 페이지: 역할 레이블에 "수학팀장" 또는 "영어팀장" 표시

**기능 접근**:
- 수학 시간표: 수학팀장만 편집 버튼 활성화
- 영어 시간표: 영어팀장만 편집 버튼 활성화
- 수업 목록: 두 팀장 모두 편집 가능

---

## FAQ

### Q1. 수학팀장과 영어팀장의 차이점은 무엇인가요?
**A.** 핵심 차이는 **시간표 편집 권한**입니다:
- 수학팀장: 수학 시간표만 편집 가능
- 영어팀장: 영어 시간표만 편집 가능
- 나머지 권한(일정 관리, 수업 목록 등)은 동일

### Q2. 팀장이 수업 목록을 편집하면 어떻게 되나요?
**A.** 수업 목록(`수업목록` 컬렉션)은 **공통 데이터**입니다:
- 수학팀장과 영어팀장 모두 편집 가능
- 변경 사항은 양쪽 팀장에게 모두 반영됨
- 학생 데이터 공유를 통해 협업 가능

### Q3. EDITOR와 팀장의 차이는 무엇인가요?
**A.** 팀장은 EDITOR보다 **더 많은 권한**을 가집니다:
- EDITOR: 시간표 보기만 가능, 수업 목록 편집 불가
- 팀장: 자신의 과목 시간표 편집 가능, 수업 목록 편집 가능

### Q4. 한 사용자가 수학팀장과 영어팀장을 동시에 할 수 있나요?
**A.** 아니요, **하나의 역할만 할당** 가능합니다:
- 시스템은 사용자당 하나의 역할만 지원
- 두 과목 모두 편집이 필요하면 ADMIN 또는 MANAGER 역할 부여

### Q5. 팀장이 시뮬레이션 모드를 사용할 수 있나요?
**A.** 아니요, 시뮬레이션 모드는 **MASTER, ADMIN, MANAGER만** 사용 가능합니다:
- 팀장은 실시간 모드에서만 편집 가능
- 안전한 테스트는 상위 역할이 담당

### Q6. 팀장 역할을 어떻게 확인하나요?
**A.** 다음 위치에서 확인 가능합니다:
- 헤더 우측 상단: 사용자 이름 옆 역할 배지
- 설정 → 사용자 관리: 사용자 목록의 역할 컬럼
- 설정 → 역할 권한: 역할 드롭다운

### Q7. 팀장 권한을 커스터마이징할 수 있나요?
**A.** 네, **MASTER 계정**으로:
- 설정 → 역할 권한 탭에서 세부 권한 조정 가능
- 예: 수학팀장에게 영어 시간표 보기 권한 제거 가능
- 변경 사항은 즉시 적용됨

---

## 수정된 파일

### [types.ts](file:///f:/ijw-calander/types.ts)
- `UserRole` 타입에 `math_lead`, `english_lead` 추가
- `ROLE_HIERARCHY` 배열 업데이트
- `ROLE_LABELS`에 한글 레이블 추가 ('수학팀장', '영어팀장')
- `DEFAULT_ROLE_PERMISSIONS`에 각 역할별 기본 권한 정의

## 사용 방법

1. **설정 → 역할 권한** 탭에서 새 역할 확인 가능
2. **설정 → 사용자 관리**에서 사용자에게 역할 할당 가능
3. 권한은 역할 권한 탭에서 세부 조정 가능

## 참고사항

### 보안 구조
- **클라이언트 측 권한 체크**: Firestore Security Rules는 기존 구조 유지
- **권한 유연성**: 역할별 세부 권한 조정이 클라이언트에서 가능
- **실시간 반영**: Firestore Rules 재배포 없이 권한 변경 즉시 적용

### UI 자동 반영
- 새 역할은 `ROLE_HIERARCHY`를 사용하는 모든 UI에 자동 반영됨
- 역할 드롭다운, 사용자 목록, 권한 설정 화면 모두 업데이트
- 추가 코드 수정 불필요

---

## 관련 문서

- **역할 권한 시스템**: [types.ts](../../types.ts)
- **영어 시간표**: [english_timetable_backup_system.md](./english_timetable_backup_system.md)
- **학생 데이터 시뮬레이션**: [student_data_simulation_mode.md](./student_data_simulation_mode.md)

---

## 변경 이력

| 날짜 | 버전 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 2026-01-02 | 2.0 | 전체 권한 목록, 역할 비교표, 사용 시나리오, FAQ 추가 | AI Assistant |
| 2026-01-02 | 1.0 | 초기 문서 작성 (수학팀장/영어팀장 역할 추가) | AI Assistant |

---

**문서 끝**
