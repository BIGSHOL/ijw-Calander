# 상담 관리 시스템 설계 보고서

## 📋 개요

**작성일**: 2026-01-10
**목적**: 재원생 대상 학부모 상담 및 학생 상담을 체계적으로 관리하는 시스템 설계
**구분**:
- **입학 상담** (기존 "콜앤상담" 탭 이름 변경) - 신규 학생 유치 관련
- **상담 관리** (신규) - 재원생 학부모/학생 상담 기록

---

## 🎯 목표

### 핵심 가치
1. **재원생 관리**: 학부모 상담, 학생 상담을 체계적으로 기록
2. **이력 추적**: 상담 내용, 날짜, 담당자, 후속 조치 등 전체 이력 관리
3. **데이터 분석**: 상담 빈도, 주요 이슈, 만족도 등 통계
4. **업무 효율**: 담당자별 상담 일정 관리, 알림 기능

### 기존 시스템과의 차이
| 항목 | 입학 상담 (기존) | 상담 관리 (신규) |
|------|-----------------|-----------------|
| 대상 | 신규 학생 (잠재 고객) | 재원생 |
| 목적 | 신규 유치, 등록 유도 | 학습 관리, 문제 해결 |
| 연동 | - | 학생 관리, 출석부 |
| 주기 | 단발성 (등록 전까지) | 지속적 (재원 기간 동안) |

---

## 📊 데이터 구조

### Consultation (상담 기록)
```typescript
interface Consultation {
  // 기본 정보
  id: string;                          // UUID
  studentId: string;                   // 학생 ID (students 컬렉션 참조)
  studentName: string;                 // 학생 이름 (스냅샷)

  // 상담 정보
  type: 'parent' | 'student';          // 상담 유형 (학부모/학생)
  consultantId: string;                // 상담자 ID (강사/직원)
  consultantName: string;              // 상담자 이름
  date: string;                        // 상담 날짜 (YYYY-MM-DD)
  time?: string;                       // 상담 시간 (HH:mm)
  duration?: number;                   // 상담 소요 시간 (분)

  // 상담 내용
  category: ConsultationCategory;      // 상담 카테고리
  subject?: 'math' | 'english' | 'all'; // 관련 과목
  title: string;                       // 상담 제목
  content: string;                     // 상담 내용 (마크다운)

  // 학부모 상담 전용 (type='parent')
  parentName?: string;                 // 학부모 이름
  parentRelation?: string;             // 관계 (부/모/조부모 등)
  parentContact?: string;              // 연락처

  // 학생 상담 전용 (type='student')
  studentMood?: 'positive' | 'neutral' | 'negative'; // 학생 컨디션

  // 후속 조치
  followUpNeeded: boolean;             // 후속 조치 필요 여부
  followUpDate?: string;               // 후속 조치 예정일
  followUpDone: boolean;               // 후속 조치 완료 여부
  followUpNotes?: string;              // 후속 조치 메모

  // 메타데이터
  createdAt: Timestamp;
  updatedAt: Timestamp;
  createdBy: string;                   // 작성자 UID
}

// 상담 카테고리
type ConsultationCategory =
  | 'academic'        // 학업 성취도
  | 'behavior'        // 행동/태도
  | 'attendance'      // 출석 관련
  | 'progress'        // 학습 진도
  | 'concern'         // 고민 상담
  | 'compliment'      // 칭찬/격려
  | 'complaint'       // 불만/개선 요청
  | 'general'         // 일반 상담
  | 'other';          // 기타
```

### Firebase 컬렉션 구조
```
consultations/
  └─ {consultationId}
      ├─ studentId: string
      ├─ type: 'parent' | 'student'
      ├─ date: string
      ├─ category: string
      ├─ content: string
      └─ ...
```

**인덱스 필요**:
- `studentId` (학생별 상담 이력)
- `consultantId` (상담자별 이력)
- `date` (날짜순 정렬)
- `followUpNeeded + followUpDone` (후속 조치 관리)

---

## 🏗️ 상담 관리 탭 설계

### 1. 화면 구성

```
┌─────────────────────────────────────────────────┐
│  상담 관리 (곤색 #081429)    [새 상담 기록 +]    │
│                              (노란색 #fdb813)   │
├─────────────────────────────────────────────────┤
│                                                 │
│  필터:  [전체 ▼]  [학부모 상담] [학생 상담]      │
│        [날짜 범위]  [검색: 학생명]               │
│        (곤색 테두리)                              │
│                                                 │
├─────────────────────────────────────────────────┤
│                                                 │
│  상담 기록 목록 (테이블 또는 카드)                │
│  ┌───────────────────────────────────────┐      │
│  │ 📅 2026-01-10  👨‍👩‍👧 학부모 상담      │      │
│  │ 학생: 김민수 (중1)    상담자: 이영희    │      │
│  │ 카테고리: 학업 성취도                  │      │
│  │ 제목: 수학 성적 향상 방안 논의          │      │
│  │ [상세보기]  [후속조치]                 │      │
│  └───────────────────────────────────────┘      │
│                                                 │
│  ┌───────────────────────────────────────┐      │
│  │ 📅 2026-01-09  👤 학생 상담            │      │
│  │ 학생: 박지은 (고2)    상담자: 김철수    │      │
│  │ 카테고리: 고민 상담                    │      │
│  │ 제목: 진로 고민 상담                   │      │
│  │ [상세보기]  [후속조치 필요]            │      │
│  └───────────────────────────────────────┘      │
│                                                 │
└─────────────────────────────────────────────────┘
```

**색상 적용**:
- **헤더**: 곤색 배경 (#081429), 흰색 텍스트
- **버튼**: 노란색 배경 (#fdb813), 곤색 텍스트
- **카드 테두리**: 곤색 (#081429) 1px
- **카드 호버**: 노란색 테두리 (#fdb813) 2px
- **제목**: 곤색 (#081429)
- **보조 텍스트**: 회색 (#373d41)
- **후속조치 배지**: 노란색 (#fdb813) 또는 빨간색 (긴급)

### 2. 상담 상세 모달

```
┌──────────────────────────────────────────────┐
│  상담 상세 (곤색 헤더)    [편집] [삭제]       │
│  (흰색 텍스트)           (노란색) (빨강)     │
├──────────────────────────────────────────────┤
│                                              │
│  📋 기본 정보 (곤색 제목)                     │
│  ────────────────────────────────────        │
│  학생: 김민수 (중1, 수학)                     │
│  상담 유형: 학부모 상담                       │
│  학부모: 김OO (모)  연락처: 010-XXXX-XXXX    │
│  상담자: 이영희 선생님                        │
│  날짜/시간: 2026-01-10 15:30 (30분)          │
│  카테고리: 학업 성취도                        │
│                                              │
│  📝 상담 내용 (곤색 제목)                     │
│  ────────────────────────────────────        │
│  제목: 수학 성적 향상 방안 논의               │
│  내용:                                       │
│  - 최근 모의고사 성적 하락 (75점 → 65점)     │
│  - 기본 개념은 이해하나 응용 문제에 약함      │
│  - 학습 태도는 양호하나 복습 부족             │
│                                              │
│  제안 사항:                                  │
│  1. 주 2회 → 주 3회로 수업 증가              │
│  2. 복습 노트 작성 습관 형성                 │
│  3. 심화반 이동 고려 (2개월 후)              │
│                                              │
│  🔔 후속 조치 (노란색 강조)                   │
│  ────────────────────────────────────        │
│  ✅ 필요함                                    │
│  예정일: 2026-01-20                          │
│  내용: 다음 모의고사 결과 확인 후 재상담       │
│  상태: 대기 중 (노란색 배지)                  │
│                                              │
└──────────────────────────────────────────────┘
```

### 3. 새 상담 기록 모달

```
┌──────────────────────────────────────────────┐
│  새 상담 기록 (곤색 헤더)    [저장] [취소]    │
├──────────────────────────────────────────────┤
│                                              │
│  1. 기본 정보                                 │
│  ────────────────────────────────────        │
│  학생 선택: [드롭다운 - 전체 재원생]          │
│  상담 유형: ○ 학부모 상담  ○ 학생 상담       │
│  상담자: [현재 로그인 사용자 자동 선택]        │
│  날짜: [2026-01-10] 시간: [15:30]            │
│  소요 시간: [30]분                            │
│                                              │
│  2. 상담 분류                                 │
│  ────────────────────────────────────        │
│  카테고리: [드롭다운 - 학업/행동/출석 등]     │
│  관련 과목: ○ 수학  ○ 영어  ○ 전체           │
│                                              │
│  3. 학부모 정보 (학부모 상담 시만 표시)        │
│  ────────────────────────────────────        │
│  이름: [    ]  관계: [부/모/조부모 등]       │
│  연락처: [010-XXXX-XXXX]                     │
│                                              │
│  4. 상담 내용                                 │
│  ────────────────────────────────────        │
│  제목: [                              ]      │
│  내용: [마크다운 에디터 - 여러 줄]            │
│                                              │
│  5. 후속 조치                                 │
│  ────────────────────────────────────        │
│  □ 후속 조치 필요                            │
│    └─ 예정일: [2026-01-20]                  │
│       메모: [                         ]      │
│                                              │
│  [저장하기 (노란색)]  [취소 (회색 테두리)]    │
│                                              │
└──────────────────────────────────────────────┘
```

---

## 💻 구현 계획

### Phase 1: 기본 구조 (1주차)

#### 1.1 데이터 모델
- `types.ts`에 Consultation 인터페이스 추가
- Firebase 컬렉션 구조 설계
- 인덱스 설정

#### 1.2 Hook 생성
```typescript
// hooks/useConsultations.ts
export const useConsultations = (filters?: ConsultationFilters)
export const useConsultationDetail = (consultationId: string)
export const useConsultationMutations = () => {
  // createConsultation
  // updateConsultation
  // deleteConsultation
}
```

#### 1.3 기본 컴포넌트
- `ConsultationManagementTab.tsx` - 메인 탭
- `ConsultationList.tsx` - 상담 목록
- `ConsultationCard.tsx` - 개별 상담 카드
- `ConsultationDetailModal.tsx` - 상담 상세

### Phase 2: CRUD 기능 (2주차)

#### 2.1 상담 생성/수정
- `AddConsultationModal.tsx` - 새 상담 기록
- `EditConsultationModal.tsx` - 상담 수정
- 학생 검색 및 선택
- 마크다운 에디터 연동

#### 2.2 후속 조치 관리
- `FollowUpPanel.tsx` - 후속 조치 목록
- 알림 기능 (예정일 임박 시)
- 완료 처리

### Phase 3: 연동 및 분석 (3주차)

#### 3.1 학생 관리 연동
- 학생 상세 화면에서 상담 이력 표시
- 학생별 상담 통계 (횟수, 최근 상담일 등)

#### 3.2 통계 대시보드
- 기간별 상담 횟수
- 카테고리별 분포
- 상담자별 통계
- 후속 조치 현황

---

## 🎨 UI/UX 고려사항

### 1. 브랜드 컬러 시스템
- **곤색 (#081429)**: 헤더, 주요 버튼, 테두리
- **노란색 (#fdb813)**: 액션 버튼, 후속 조치 배지
- **회색 (#373d41)**: 보조 텍스트
- **빨간색 (#ef4444)**: 긴급 후속 조치

### 2. 카드 디자인
```typescript
// 상담 유형별 색상
const consultationType = {
  parent: {
    icon: '👨‍👩‍👧',
    color: '#081429',  // 곤색
    bgLight: '#1a2845',
  },
  student: {
    icon: '👤',
    color: '#081429',  // 곤색
    bgLight: '#2a3f5f',
  }
};

// 카테고리별 아이콘
const categoryIcons = {
  academic: '📚',     // 학업
  behavior: '⚠️',    // 행동
  attendance: '📅',  // 출석
  progress: '📈',    // 진도
  concern: '💭',     // 고민
  compliment: '⭐',  // 칭찬
  complaint: '📢',   // 불만
  general: '💬',     // 일반
  other: '📝',       // 기타
};
```

### 3. 후속 조치 상태 표시
```css
/* 대기 중 */
badge: 노란색 배경 (#fdb813), 곤색 텍스트

/* 긴급 (3일 이내) */
badge: 빨간색 배경 (#ef4444), 흰색 텍스트

/* 완료 */
badge: 초록색 배경 (#10b981), 흰색 텍스트
```

---

## 📋 필터링 및 검색

### 필터 옵션
1. **상담 유형**: 전체 / 학부모 상담 / 학생 상담
2. **날짜 범위**: 오늘 / 이번 주 / 이번 달 / 사용자 지정
3. **카테고리**: 학업, 행동, 출석 등
4. **상담자**: 전체 / 개별 상담자
5. **후속 조치**: 전체 / 필요함 / 완료됨 / 대기 중
6. **과목**: 수학 / 영어 / 전체

### 검색 기능
- 학생 이름
- 상담 제목
- 상담 내용 (전문 검색)

### 정렬 옵션
- 날짜 (최신순/오래된순)
- 학생 이름 (가나다순)
- 후속 조치 예정일 (가까운순)

---

## 🔄 데이터 흐름

### 상담 생성 플로우
```
AddConsultationModal
  └─ 학생 선택 (useStudents)
      └─ 상담 정보 입력
          └─ useConsultationMutations.create()
              └─ Firebase consultations/ 생성
                  └─ React Query 캐시 무효화
                      └─ UI 자동 업데이트
```

### 학생별 상담 이력 조회
```
StudentDetail (학생 관리 탭)
  └─ useConsultations({ studentId })
      └─ Firebase consultations/ 쿼리
          └─ 해당 학생의 모든 상담 기록
              └─ 시간순 정렬 표시
```

---

## 🔔 알림 및 후속 조치

### 알림 시나리오
1. **후속 조치 예정일 D-3**: 노란색 배지
2. **후속 조치 예정일 D-1**: 빨간색 배지
3. **후속 조치 예정일 당일**: 알림 + 빨간색 강조
4. **후속 조치 지연**: 빨간색 배지 + 경고 메시지

### 후속 조치 워크플로우
```
1. 상담 기록 시 "후속 조치 필요" 체크
2. 예정일 설정
3. 예정일 임박 시 알림 표시
4. 후속 조치 완료 처리
5. 완료 메모 작성
```

---

## 📊 통계 및 분석

### 대시보드 위젯

#### 1. 상담 현황 요약 (카드)
```
┌─────────────┬─────────────┬─────────────┐
│  이번 주    │  이번 달    │  총 상담    │
│   15건      │   43건      │  287건      │
│ (전주 +3)   │ (전월 -5)   │             │
└─────────────┴─────────────┴─────────────┘
```

#### 2. 카테고리별 분포 (파이 차트)
- 학업 성취도: 35%
- 행동/태도: 20%
- 고민 상담: 15%
- 기타: 30%

#### 3. 후속 조치 현황 (프로그레스 바)
- 대기 중: 8건
- 완료: 12건
- 지연: 2건 (빨간색 강조)

#### 4. 상담자별 통계 (테이블)
| 상담자 | 총 상담 수 | 이번 달 | 평균 소요 시간 |
|--------|-----------|---------|---------------|
| 이영희 | 45건      | 12건    | 25분          |
| 김철수 | 38건      | 10건    | 30분          |

---

## 🔐 권한 관리

### 권한 레벨
1. **Master/Admin**: 모든 상담 기록 조회/수정/삭제
2. **강사**: 본인이 작성한 상담 기록만 조회/수정
3. **일반 직원**: 조회만 가능

### 권한별 기능
```typescript
interface ConsultationPermissions {
  view: boolean;      // 상담 기록 조회
  create: boolean;    // 새 상담 기록 작성
  edit: boolean;      // 상담 기록 수정
  delete: boolean;    // 상담 기록 삭제
  viewAll: boolean;   // 전체 상담 기록 조회 (본인 것만 or 전체)
}
```

---

## 📁 파일 구조

```
components/ConsultationManagement/
  ├─ ConsultationManagementTab.tsx     # 메인 탭
  ├─ ConsultationList.tsx              # 상담 목록
  ├─ ConsultationCard.tsx              # 개별 상담 카드
  ├─ ConsultationDetailModal.tsx       # 상담 상세 모달
  ├─ AddConsultationModal.tsx          # 상담 추가 모달
  ├─ EditConsultationModal.tsx         # 상담 수정 모달
  ├─ FollowUpPanel.tsx                 # 후속 조치 패널
  ├─ ConsultationStats.tsx             # 통계 위젯
  └─ index.ts

hooks/
  ├─ useConsultations.ts               # 상담 목록 조회
  ├─ useConsultationDetail.ts          # 상담 상세 조회
  ├─ useConsultationMutations.ts       # 상담 CRUD
  └─ useConsultationStats.ts           # 상담 통계

types.ts
  └─ Consultation, ConsultationCategory 추가
```

---

## 🧪 테스트 시나리오

### 기본 기능
1. ✅ 새 상담 기록 생성
2. ✅ 학부모 상담 / 학생 상담 구분 표시
3. ✅ 상담 상세 조회
4. ✅ 상담 수정
5. ✅ 상담 삭제
6. ✅ 필터링 (유형, 날짜, 카테고리)
7. ✅ 검색 (학생명, 제목)

### 후속 조치
1. ✅ 후속 조치 필요 설정
2. ✅ 예정일 임박 알림 표시
3. ✅ 후속 조치 완료 처리
4. ✅ 후속 조치 지연 경고

### 연동
1. ✅ 학생 상세에서 상담 이력 표시
2. ✅ 상담 기록에서 학생 상세로 이동
3. ✅ 통계 대시보드 정확성

---

## 🚀 우선순위

### High Priority (필수)
1. ✅ ConsultationManagementTab 기본 구조
2. ✅ ConsultationList + ConsultationCard
3. ✅ AddConsultationModal (학부모/학생 구분)
4. ✅ 필터링 및 검색
5. ✅ 후속 조치 기능

### Medium Priority (중요)
6. ⬜ EditConsultationModal
7. ⬜ ConsultationDetailModal
8. ⬜ 학생 관리 탭과 연동
9. ⬜ 통계 대시보드

### Low Priority (나중에)
10. ⬜ 마크다운 에디터
11. ⬜ 파일 첨부 기능
12. ⬜ 상담 기록 PDF 내보내기
13. ⬜ 상담 일정 캘린더 뷰

---

## 💡 추가 아이디어

### 1. 상담 템플릿
- 자주 사용하는 상담 패턴을 템플릿으로 저장
- "성적 하락 상담", "진로 상담" 등 미리 정의된 양식

### 2. 태그 시스템
- 상담 기록에 태그 추가 (#성적향상 #진로고민 등)
- 태그별 검색 및 필터링

### 3. 상담 예약 시스템
- 학부모가 상담 예약 가능
- 상담자의 일정과 연동

### 4. 상담 만족도 조사
- 상담 후 간단한 만족도 평가
- 피드백 수집

### 5. AI 분석
- 상담 내용 키워드 분석
- 주요 이슈 자동 추출
- 상담 트렌드 분석

---

## 🎯 성공 지표

### 기능적 지표
- ✅ 모든 상담 CRUD 작업 가능
- ✅ 학생 관리와 양방향 연동
- ✅ 후속 조치 관리 기능

### 성능 지표
- ⬜ 상담 목록 로딩 시간 < 1초
- ⬜ 검색 응답 시간 < 500ms
- ⬜ 1000개 상담 기록까지 부드러운 스크롤

### UX 지표
- ⬜ 직관적인 UI (사용자 피드백)
- ⬜ 모바일 친화적 반응형 디자인
- ⬜ 후속 조치 알림 명확성

---

## 📝 구현 순서

### Week 1: 기본 구조
1. Consultation 타입 정의
2. useConsultations Hook 생성
3. ConsultationManagementTab 컴포넌트
4. ConsultationList, ConsultationCard

### Week 2: CRUD 기능
5. AddConsultationModal
6. 학생 선택 UI
7. 학부모/학생 상담 구분
8. 후속 조치 기능

### Week 3: 상세 및 편집
9. ConsultationDetailModal
10. EditConsultationModal
11. 삭제 기능
12. 필터링 및 검색

### Week 4: 통합 및 통계
13. 학생 관리 탭 연동
14. 통계 대시보드
15. 알림 기능
16. 최종 테스트

---

## 🔗 다른 시스템과의 연동

### 학생 관리
- 학생 상세 화면에 "상담 이력" 탭 추가
- 상담 횟수, 최근 상담일 표시
- 빠른 상담 기록 추가 버튼

### 출석부
- 출석 기록과 연계
- 결석/지각이 많은 학생 자동 알림
- "출석 관련 상담 필요" 플래그

### 수업 관리
- 수업별 상담 통계
- 특정 수업의 문제점 파악

### 시간표
- 상담 일정을 시간표에 표시
- 상담 시간 블록 예약

---

**작성자**: AI Assistant
**검토자**: -
**승인자**: -
**문서 버전**: 1.0
